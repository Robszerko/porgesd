<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P√∂rgesd Fel!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark-blue: #1A237E;
            --bg-purple: #3F51B5;
            --bg-card: rgba(26, 35, 126, 0.6);
            --font-color-light: #E8EAF6;
            --font-color-dark: #1A237E;
            --accent-gold: #FFC107;
            --accent-pink: #E91E63;
            --accent-teal: #00BCD4;
            --pointer-red: #F44336;
            --tile-border-color: #5C6BC0;
            --special-prize-color: #B39DDB;
            --win-green: #66BB6A;
            --lose-red: #EF5350;
            --halver-orange: #FF8A65;
            --surprise-purple: #9575CD;
            --lotto-green: #4CAF50;
        }

        body {
            background-color: var(--bg-dark-blue);
            background-image: radial-gradient(circle at top right, var(--bg-purple) 0%, transparent 50%),
                              radial-gradient(circle at bottom left, var(--bg-purple) 0%, transparent 40%);
            font-family: 'Lato', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: var(--font-color-light);
            text-rendering: optimizeLegibility;
            transition: background 0.5s ease;
            position: relative;
            overflow-x: hidden;
        }

        body.sunday-special {
             background-color: #1A237E;
             background-image:
                radial-gradient(ellipse at 80% 20%, rgba(255, 215, 0, 0.25) 0%, transparent 40%),
                radial-gradient(ellipse at 20% 80%, rgba(103, 58, 183, 0.4) 0%, transparent 50%),
                linear-gradient(160deg, #1A237E 0%, #311B92 100%);
        }

        body.sunday-special::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: transparent;
            box-shadow:
                -15vw 20vh 2px 1px #FFD700, 10vw 40vh 3px 1px #FFD700,
                30vw 90vh 2px 0px #FFD700, 50vw 10vh 2px 1px #FFD700,
                70vw 70vh 3px 1px #FFD700, 90vw 30vh 2px 1px #FFD700,
                -5vw 80vh 2px 0px #FFD700, 40vw 55vh 3px 0px #FFD700;
        }


        header {
            width: 100%;
            max-width: 1400px;
            padding-bottom: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        #logo-container {
            width: clamp(80px, 10vw, 120px);
            flex-shrink: 0;
            cursor: pointer;
        }

        #logo-svg {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        #game-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            color: var(--font-color-light);
            text-shadow: 2px 2px 0px var(--bg-dark-blue), 4px 4px 8px rgba(0,0,0,0.5);
        }

        #sunday-title {
            display: none;
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--accent-gold);
            text-shadow: 0 0 10px var(--accent-gold);
            margin-top: -15px;
            margin-bottom: 10px;
        }
        body.sunday-special #sunday-title {
            display: block;
        }

        #tv-container {
            width: 100%;
            max-width: 1400px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        #screen {
            background-color: rgba(18, 18, 18, 0.5);
            border-radius: 15px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            width: 100%;
            padding: clamp(10px, 2vw, 20px);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }

        #game-area {
            display: flex;
            gap: 20px;
            flex-grow: 1;
            position: relative;
            z-index: 2;
        }

        #puzzle-section {
            flex: 3;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        #puzzle-category-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #lotto-bajnok-icon {
            font-size: 2rem;
            color: var(--lotto-green);
            text-shadow: 0 0 10px var(--lotto-green);
            display: none;
        }
        #puzzle-category {
            background: linear-gradient(145deg, var(--accent-pink), #AD1457);
            color: var(--font-color-light);
            padding: 10px 20px;
            border-radius: 50px;
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(1rem, 2vw, 1.5rem);
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(233, 30, 99, 0.3);
        }
        #puzzle-category.golden {
            background: linear-gradient(145deg, var(--accent-gold), #FF8F00);
            box-shadow: 0 0 20px var(--accent-gold);
            color: var(--font-color-dark);
        }
        
        #free-vowel-indicator {
            background-color: var(--win-green);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 5px;
            display: none;
            box-shadow: 0 0 10px var(--win-green);
        }

        #round-info-container {
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--tile-border-color);
            border-radius: 8px;
            padding: 8px 15px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px 20px;
        }
        #round-display, #hour-block-display {
            font-size: 1rem;
            font-weight: 700;
            color: var(--font-color-light);
        }

        #copyright-notice {
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 8px;
            font-style: italic;
        }
        
        #auto-hints-container {
            width: 90%;
            max-width: 600px;
            text-align: center;
            font-size: 0.95rem;
            color: var(--accent-teal);
            margin-top: 15px;
            font-style: italic;
            line-height: 1.5;
            display: none;
            padding: 10px;
            background-color: rgba(0, 188, 212, 0.1);
            border: 1px solid var(--accent-teal);
            border-radius: 8px;
        }

        @keyframes hint-flash {
            0%, 100% { opacity: 1; transform: scale(1); }
            16%, 48%, 80% { opacity: 0.2; transform: scale(0.98); }
            32%, 64%, 96% { opacity: 1; transform: scale(1.02); }
        }

        .hint-appearing {
            animation: hint-flash 0.5s ease-in-out 3;
        }

        #puzzle-board {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
            margin-top: auto;
            margin-bottom: auto;
        }
        .puzzle-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            width: 100%;
        }
        .puzzle-tile {
            width: clamp(35px, 5.5vw, 50px);
            height: clamp(45px, 7vw, 65px);
            perspective: 1000px;
        }

        .tile-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .puzzle-tile.revealed .tile-inner {
            transform: rotateY(180deg);
        }

        .tile-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
        }

        .tile-front {
            background-color: rgba(0,0,0,0.2);
            border: 2px solid var(--tile-border-color);
        }

        @keyframes flash-effect {
            0%, 100% {
                box-shadow: 0 0 5px rgba(0, 188, 212, 0.5);
                border-color: var(--tile-border-color);
            }
            50% {
                box-shadow: 0 0 20px 8px var(--accent-teal);
                border-color: var(--accent-teal);
            }
        }
        .tile-front.flashing {
            animation: flash-effect 1.2s ease-in-out;
        }


        .tile-back {
            background-color: var(--font-color-light);
            color: var(--font-color-dark);
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            transform: rotateY(180deg);
            text-shadow: 0 0 2px var(--accent-teal);
        }

        .puzzle-tile.space { background-color: transparent; border: none; }
        .puzzle-tile.space .tile-inner { display: none; }

        .puzzle-tile.special-char {
            background-color: var(--font-color-light); color: var(--font-color-dark);
            font-weight: 700; font-size: clamp(1.5rem, 4vw, 2.5rem); border-radius: 5px;
            display: flex; justify-content: center; align-items: center;
        }
        .puzzle-tile.special-char .tile-inner { display: none; }

        #alphabet-panel {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 5px;
            background-color: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;
            margin-top: auto;
        }
        .alphabet-key {
            width: 35px; height: 35px; font-family: 'Lato', sans-serif; font-weight: 700;
            font-size: 1rem; border: none; border-bottom: 3px solid rgba(0,0,0,0.4);
            border-radius: 5px; cursor: pointer; background-color: #C5CAE9;
            color: var(--font-color-dark); transition: all 0.1s ease;
        }
        .alphabet-key.vowel { background-color: var(--special-prize-color); }
        .alphabet-key:hover:not(:disabled) { background-color: var(--accent-gold); transform: translateY(-2px); }
        .alphabet-key:active:not(:disabled) { transform: translateY(1px); border-bottom-width: 1px; }
        .alphabet-key:disabled {
            background-color: #5C6BC0; color: #9FA8DA; cursor: not-allowed;
            opacity: 0.7; border-bottom: 3px solid #1A237E;
        }

        #game-controls-section {
            flex: 2; display: flex; flex-direction: column;
            justify-content: space-around; align-items: center; gap: 15px;
        }

        #player-info-wrapper, #game-interaction-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }


        #wheel-wrapper {
            position: relative; width: clamp(280px, 40vh, 380px); aspect-ratio: 1 / 1;
        }

        #wheel-pointer {
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
            border-top: 30px solid var(--pointer-red); position: absolute; top: -15px; left: 50%;
            transform: translateX(-50%); z-index: 10; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
            border-radius: 3px; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        #wheel {
            width: 100%; height: 100%; transition: transform 5s cubic-bezier(0.2, 0.8, 0.25, 1);
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4)); border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
        }

        #wheel-center-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle, var(--bg-purple) 60%, var(--bg-dark-blue) 100%);
            color: var(--font-color-light);
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            font-size: 1.1rem;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.5), inset 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.2s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0;
        }
        #wheel-center-button:hover:not(:disabled) {
            background: radial-gradient(circle, #5C6BC0 60%, #303F9F 100%);
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.8), inset 0 0 10px rgba(0,0,0,0.5);
            transform: translate(-50%, -50%) scale(1.05);
        }
        #wheel-center-button:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            opacity: 0.7;
        }
        #wheel-center-text {
            position: relative;
            z-index: 2;
        }
        #booster-svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        #booster-svg circle {
            fill: none;
            stroke-width: 8;
        }
        #booster-svg .booster-bg {
            stroke: rgba(26, 35, 126, 0.7);
        }
        #booster-svg .booster-bar {
            stroke: var(--accent-gold);
            stroke-linecap: round;
        }

        @keyframes wheel-flash {
            0%, 100% { filter: brightness(1); }
            16%, 48%, 80% { filter: brightness(2.5) drop-shadow(0 0 8px white); }
            32%, 64%, 96% { filter: brightness(1); }
        }
        .flashing-segment { animation: wheel-flash 0.9s ease-in-out; }

        #all-huds-container {
             display: flex; flex-direction: row; justify-content: center;
             align-items: stretch; gap: 15px; flex-wrap: wrap;
             width: 100%; max-width: 750px; margin: 0 auto;
        }

        .player-hud {
            flex: 1; min-width: 180px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; gap: 5px;
            background: rgba(0,0,0,0.2); padding: 10px 15px; border-radius: 10px;
            border: 1px solid var(--accent-gold); text-align: center;
            position: relative;
        }

        #lotto-prize-hud {
            border-color: var(--lotto-green);
            cursor: pointer;
        }
        #prize-chest-hud {
            border-color: #a97e41;
            cursor: pointer;
        }
        .prize-chest-svg {
            width: 24px;
            height: 24px;
        }
        
        #lotto-prize-count, #prize-chest-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--pointer-red);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .hud-label {
            font-size: clamp(0.9rem, 1.5vw, 1rem); color: var(--font-color-light);
            font-weight: 700; margin-bottom: 5px; display: flex; align-items: center; gap: 8px;
        }
        #millionaire-icon { display: none; font-size: 1.5rem; animation: pulse 2s infinite; }
        body.millionaire-active #millionaire-icon { display: inline-block; }

        #score-display, #hourly-winnings-display, #round-winnings-display, #lotto-prize-label {
            font-family: 'Montserrat', sans-serif; font-size: clamp(1.6rem, 3vw, 2rem);
            color: var(--accent-gold); font-weight: 700;
            text-shadow: 0 0 8px var(--accent-gold); line-height: 1;
        }

        #round-winnings-display {
            color: var(--accent-teal); text-shadow: 0 0 8px var(--accent-teal);
        }
        
        #lotto-prize-label, #prize-chest-label {
            font-size: clamp(1rem, 2vw, 1.2rem); color: var(--lotto-green); text-shadow: 0 0 8px var(--lotto-green);
        }
        #prize-chest-label {
            color: #d4ac0d; text-shadow: 0 0 8px #d4ac0d;
        }

        #main-prize-progress {
            background-color: rgba(255, 193, 7, 0.1); border: 1px solid var(--accent-gold);
            color: #f4e9d8; padding: 8px; border-radius: 8px; width: 90%; max-width: 400px;
            text-align: center; font-size: 0.9rem; display: none;
        }
        #main-prize-progress strong { color: var(--accent-gold); }

        #won-prize-container {
            display: none; flex-direction: column; align-items: center; background-color: rgba(0,0,0,0.2);
            border: 1px solid var(--special-prize-color); border-radius: 10px; padding: 8px 15px;
            margin-top: 10px; width: 90%; max-width: 350px; text-align: center;
        }
        #won-prize-container .prize-label { font-size: 0.8rem; text-transform: uppercase; color: #ddd; }
        #won-prize-container .prize-name {
            font-size: 1.1rem; font-weight: bold; color: var(--special-prize-color);
            text-shadow: 0 0 5px var(--special-prize-color);
        }

        .host-message-style {
            background: rgba(0,0,0,0.2); border: 1px solid var(--tile-border-color);
            color: white; padding: 10px; border-radius: 10px; min-height: 4em; text-align: center;
            font-size: clamp(0.9rem, 1.5vw, 1.1rem); display: flex; align-items: center;
            justify-content: center; width: 100%; max-width: 400px; transition: border-color 0.3s ease;
        }
        .host-message-style strong { color: var(--accent-gold); font-weight: 700; }
        .host-message-style a {
            color: var(--accent-teal); text-decoration: underline;
            font-weight: bold; cursor: pointer;
        }
        #host-message-desktop { display: none; }

        #power-meter-container { display: none; }

        #action-buttons {
            display: flex; gap: 10px; justify-content: center; width: 100%; flex-wrap: wrap;
        }
        .action-btn {
            padding: 12px 15px; font-family: 'Montserrat', sans-serif; font-weight: 700;
            font-size: clamp(0.8rem, 2vw, 1rem); border-radius: 8px; border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); cursor: pointer;
            transition: all 0.2s ease; text-transform: uppercase; flex-grow: 1; max-width: 150px;
        }
        .action-btn:hover:not(:disabled) { filter: brightness(1.1); transform: translateY(-2px); }
        .action-btn:active:not(:disabled) { transform: translateY(1px); box-shadow: 0 2px 3px rgba(0,0,0,0.3); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; background-color: #555 !important; color: #999 !important; }

        .solve-btn { background-color: var(--accent-gold); color: var(--font-color-dark); }
        .transfer-btn { background-color: var(--surprise-purple); color: white; }
        .lotto-btn { background-color: var(--lotto-green); color: white; }
        .nyero21-btn { background-color: var(--win-green); color: white; }

        #spin-button { display: none; }
        #solve-button { background-color: var(--accent-gold); color: var(--font-color-dark); }
        #transfer-button { background-color: var(--surprise-purple); color: white; }
        #lotto-button { background-color: var(--lotto-green); color: white; }
        #nyero21-button { background-color: var(--win-green); color: white; }
        #new-game-button { background-color: #78909C; color: white; margin-top: 10px; width: 100%; max-width: 480px;}
        #skip-error-btn { background-color: var(--pointer-red); color: white; margin-top: 10px; width: 100%; max-width: 480px; display: none; }

        #desktop-action-buttons { display: none; }

        #rules-container {
            background: var(--bg-card); color: var(--font-color-light);
            padding: 20px; margin-top: 20px; width: 100%; max-width: 1400px;
            border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        #rules-container h2 { font-family: 'Montserrat', sans-serif; color: var(--accent-gold); text-align: center; margin-top: 0; text-shadow: 0 0 8px var(--accent-gold); font-size: 2.2rem; }
        #rules-container ul { list-style-type: none; padding: 0; }
        #rules-container li { margin-bottom: 15px; padding-left: 35px; position: relative; line-height: 1.5; font-size: 1rem; }
        #rules-container li::before {
            content: 'üéØ';
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 1.5rem; position: absolute; left: 0; top: 0;
        }
        #rules-container li.gameplay::before { content: 'üîÑ'; }
        #rules-container li.lotto::before { content: 'üéüÔ∏è'; }
        #rules-container li.dynamic-wheel::before { content: '‚ú®'; }
        #rules-container li.minigame::before { content: 'üÉè'; }
        #rules-container li.prizes::before { content: 'üéÅ'; }
        #rules-container li.week::before { content: 'üóìÔ∏è'; }
        #rules-container li.sunday::before { content: 'üåü'; }
        #rules-container li.main-prize::before { content: 'üèÜ'; }
        #rules-container li.millionaire::before { content: 'üëë'; }
        #rules-container li.exit::before { content: 'üö™'; }
        #rules-container strong { color: var(--accent-gold); font-weight: 700; }
        #rules-container .sub-rule { font-size: 0.9em; color: #C5CAE9; margin-top: 8px; font-style: italic; }
        #rules-container .sub-rule ul { margin-top: 8px; }
        #rules-container .sub-rule li { font-size: 0.95em; margin-bottom: 5px; padding-left: 25px; }
        #rules-container .sub-rule li::before { content: 'üîπ'; font-size: 1rem; top: 4px;}


        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: flex;
            justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: #303F9F; padding: 30px;
            border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 25px rgba(0,0,0,0.7); text-align: center;
            color: var(--font-color-light); width: 90%; max-width: 500px;
            transform: scale(0.9); transition: transform 0.3s ease;
            position: relative;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-content h3 {
            font-family: 'Montserrat', sans-serif; color: var(--accent-gold);
            margin-top: 0; font-size: 2rem; text-shadow: 0 0 8px var(--accent-gold);
        }
        .modal-content p { font-size: 1.1rem; margin-bottom: 20px; }
        .modal-input {
            width: 100%; padding: 10px; font-size: 1.2rem; border-radius: 5px;
            border: 2px solid var(--accent-gold); background: #1A237E;
            color: var(--font-color-light); box-sizing: border-box; margin-bottom: 20px;
            text-transform: uppercase;
        }
        .modal-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
        .modal-btn {
            padding: 12px 25px; font-family: 'Montserrat', sans-serif;
            font-weight: 700; font-size: 1rem; border-radius: 8px; border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3); cursor: pointer;
            transition: all 0.2s ease; text-transform: uppercase;
        }
        .modal-btn.confirm { background-color: var(--accent-gold); color: var(--font-color-dark); }
        .modal-btn.cancel { background-color: #78909C; color: white; }
        
        #dev-modal .modal-content { max-width: 600px; }
        #dev-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .dev-mode-indicator {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--pointer-red);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
        }


        #main-prize-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: none; flex-direction: column; justify-content: center;
            align-items: center; color: white; padding: 20px; box-sizing: border-box;
            backdrop-filter: blur(10px);
        }
        #main-prize-modal h2, #main-prize-modal h3 {
            font-family: 'Montserrat', sans-serif;
            color: var(--accent-gold); text-shadow: 0 0 15px var(--accent-gold); margin-bottom: 10px;
            position:relative; display: block; text-align: center;
        }
        #main-prize-title { font-size: clamp(2rem, 8vw, 4rem); }
        #main-prize-category { font-size: clamp(1.2rem, 4vw, 2rem); }
        #main-prize-board { margin-top: 20px; }
        #main-prize-board .puzzle-tile { width: clamp(40px, 6vw, 60px); height: clamp(50px, 8vw, 75px); }
        #main-prize-board .tile-back { font-size: clamp(2rem, 5vw, 3rem); }
        #main-prize-given-letters, #main-prize-final-answer { margin-top: 20px; font-size: 1.2rem; position:relative; display: block; text-align: center;}
        #main-prize-final-answer { color: var(--win-green); font-weight: bold; }
        #main-prize-timer {
            font-size: clamp(3rem, 12vw, 6rem); font-weight: 700;
            color: var(--accent-gold); margin: 10px 0; text-shadow: 0 0 10px var(--accent-gold);
            position:relative; display: block;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #main-prize-timer.timer-low { color: var(--pointer-red); animation: pulse 0.5s infinite; text-shadow: 0 0 10px var(--pointer-red); }

        #main-prize-instructions {
            position: relative; display: block; min-height: 1.2em;
            margin-top: 15px;
            transition: color 0.3s ease;
        }
        #main-prize-alphabet-panel-container, #main-prize-solve-input, #main-prize-confirm-btn {
            position: relative; display: block;
        }
        #main-prize-solve-input { margin: 15px auto; display: block; }
        #main-prize-alphabet-panel-container { margin-top: 20px; }
        
        #nyero21-modal, #lotto-modal, #active-bonuses-modal, #prize-chest-modal { z-index: 1500; }
        #nyero21-modal .modal-content, #lotto-modal .modal-content, #active-bonuses-modal .modal-content, #prize-chest-modal .modal-content {
            max-width: 800px;
            background: transparent;
            border: none;
            box-shadow: none;
            overflow: visible;
        }
        #nyero21-content-wrapper, #lotto-content-wrapper, #bonuses-content-wrapper, #chest-content-wrapper {
            position: relative;
            padding: 30px;
            border-radius: 15px;
            background: #1A237E linear-gradient(180deg, rgba(63,81,181,0.5) 0%, rgba(26,35,126,0) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 25px rgba(0,0,0,0.7);
        }
        #nyero21-table-svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 105%;
            height: 105%;
            z-index: -1;
        }
        #nyero21-joker {
            width: 150px;
            position: absolute;
            right: 0px;
            bottom: 0px;
            opacity: 0.4;
            transform: rotate(-15deg);
        }
        #nyero21-game-area { display: none; }
        #nyero21-info-bar {
            background-color: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            text-align: left;
            line-height: 1.6;
        }
        #nyero21-info-bar strong {
            color: var(--accent-gold);
            font-weight: 700;
        }
        #nyero21-card-deck {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
            margin-bottom: 20px; perspective: 800px;
        }
        .nyero21-card {
            width: 70px; height: 100px; cursor: pointer; position: relative;
            transform-style: preserve-3d; transition: transform 0.5s;
        }
        .nyero21-card.flipped { transform: rotateY(180deg); cursor: default; }
        .nyero21-card-face {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
            border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .nyero21-card-back {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-pink));
            border: 2px solid var(--font-color-light);
        }
        .nyero21-card-front {
            background-color: var(--font-color-light); transform: rotateY(180deg);
            display: flex; justify-content: center; align-items: center; font-size: 2.5rem;
            font-family: 'Montserrat', sans-serif; font-weight: 900; color: var(--font-color-dark);
        }
        #nyero21-player-hand { margin: 15px 0; }
        #nyero21-player-score {
            font-size: 4rem; color: var(--accent-gold); font-family: 'Montserrat';
            text-shadow: 0 0 10px var(--accent-gold);
        }
        #nyero21-result-message { font-size: 1.5rem; font-weight: bold; min-height: 2em; }
        #nyero21-result-message.win { color: var(--win-green); }
        #nyero21-result-message.lose { color: var(--lose-red); }

        /* LOTTO STYLES */
        #lotto-modal .modal-content { max-width: 600px; }
        #lotto-betting-area { position: relative; }
        #lotto-ticket-svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }
        #lotto-ticket-content {
            padding: 20px;
        }
        #lotto-selected-display {
            font-size: 1.1rem;
            color: var(--font-color-dark);
            font-weight: bold;
            background-color: rgba(255,255,255,0.8);
            padding: 8px;
            border-radius: 5px;
            min-height: 1.5em;
            margin-bottom: 15px;
            text-shadow: none;
        }
        #lotto-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 8px; margin: 20px 0; }
        .lotto-number {
            width: 38px; height: 38px; display: flex; justify-content: center; align-items: center;
            background-color: #C5CAE9; color: var(--font-color-dark);
            border-radius: 50%; font-weight: bold; cursor: pointer;
            border: 2px solid transparent; transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        .lotto-number:hover { background-color: var(--accent-gold); }
        .lotto-number.selected {
            background-color: var(--accent-pink); color: white; border-color: white;
            transform: scale(1.1); box-shadow: 0 0 10px var(--accent-pink);
        }
        .lotto-number.disabled { opacity: 0.6; cursor: not-allowed; background-color: #5C6BC0; }
        .lotto-drawing-container { margin-top: 20px; }
        .lotto-ball-wrapper { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 10px;}
        .lotto-ball {
            width: 50px; height: 50px; border-radius: 50%; display: flex;
            justify-content: center; align-items: center; font-family: 'Montserrat'; font-weight: 900; font-size: 1.5rem;
            background: radial-gradient(circle at 30% 30%, #fff, #ddd);
            color: #333; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.3), 0 2px 5px rgba(0,0,0,0.5);
        }
        .submitted-ticket-container { margin-top: 15px; background-color: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; }
        .submitted-ticket-header { font-weight: bold; text-transform: uppercase; color: var(--accent-teal); font-size: 0.9rem; }
        .submitted-ticket-numbers { display: flex; gap: 8px; justify-content: center; margin-top: 5px; }
        .submitted-ticket-number {
             width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
             background-color: #9FA8DA; font-weight: bold;
        }
        .submitted-ticket-number.match { background-color: var(--lotto-green); color: white; box-shadow: 0 0 10px var(--lotto-green); }
        #active-bonuses-list, #prize-chest-list { list-style-type: none; padding: 0; max-height: 40vh; overflow-y: auto;}
        #active-bonuses-list li, #prize-chest-list li { background-color: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; }
        #prize-chest-list li { flex-direction: row; justify-content: space-between;}
        #prize-chest-list .prize-info { text-align: left;}

        .bonus-name { font-weight: bold; color: var(--lotto-green); font-size: 1.2rem;}
        .bonus-expiry, .prize-expiry { font-size: 0.8rem; color: #ccc; margin-top: 5px;}
        .activate-prize-btn {
            padding: 8px 12px; font-size: 0.8rem;
            background-color: var(--win-green); color: white;
            margin-left: 10px; flex-shrink: 0;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }

        /* Responsive Layout Switch */
        @media (max-width: 900px) {
            body { padding: 10px; }
            header { flex-direction: column; gap: 5px; }
            #game-title { font-size: clamp(2rem, 10vw, 3rem); }
            #tv-container { padding: 15px; border-radius: 15px; }
            #screen { padding: 10px; border-radius: 10px; gap: 15px; }
            #game-area { flex-direction: column; align-items: center; gap: 25px; }
            #puzzle-section, #game-controls-section { width: 100%; max-width: 450px; }
            #rules-container h2 { font-size: 1.8rem; } #rules-container li { font-size: 0.9rem; }
            #lotto-grid { gap: 5px; }
            .lotto-number { width: 32px; height: 32px; }
            #wheel-center-button { width: 70px; height: 70px; font-size: 0.9rem; }
            #booster-svg circle { stroke-width: 7; }

            #game-controls-section {
                display: flex;
                flex-direction: column;
            }

            #player-info-wrapper {
                order: 2;
                display: flex;
                flex-direction: column;
            }

            #game-interaction-wrapper { order: 1; }

            #all-huds-container { order: 2; margin-top: 15px; flex-direction: column; align-items: center; }
            .player-hud { width: 90%; max-width: 350px; }
            #main-prize-progress { order: 1; margin-bottom: 10px; }
            #won-prize-container { order: 3; }
        }

        @media (min-width: 901px) {
            #game-area { align-items: flex-end; }
            #player-info-wrapper { order: 1; }
            #game-interaction-wrapper { order: 2; }
            #puzzle-section { flex-direction: column; flex: 4; }

            #round-info-container { order: 1; margin: 0 auto 15px auto; width: auto; max-width: none; padding: 10px 30px; background-color: rgba(0,0,0,0.3); border-radius: 50px; border-width: 2px; }
            #puzzle-category-wrapper { order: 2; margin-bottom: 15px; }
            #puzzle-board { order: 3; margin-top: 0; margin-bottom: 0; }
            #auto-hints-container { order: 4; }
            #alphabet-panel { order: 5; margin: 25px auto 0 auto; width: 100%; max-width: 800px; }
            #desktop-action-buttons { order: 6; }
            #host-message-desktop { order: 7; }
            #free-vowel-indicator { order: 8; margin: 15px auto 0 auto; }
            #copyright-notice { order: 9; margin-top: 15px; }

            #puzzle-category { font-size: clamp(1.2rem, 1.8vw, 1.7rem); }
            .puzzle-tile { width: clamp(45px, 5vw, 60px); height: clamp(60px, 6.5vw, 75px); }
            .tile-back { font-size: clamp(2rem, 3.5vw, 3.2rem); }
            #alphabet-panel { gap: 8px; padding: 15px; }
            .alphabet-key { width: 45px; height: 45px; font-size: 1.3rem; border-radius: 8px; }
            
            #wheel-center-button { width: 90px; height: 90px; }
            #booster-svg circle { stroke-width: 9; }
            
            #desktop-action-buttons {
                display: flex;
                gap: 15px;
                justify-content: center;
                width: 100%;
                margin-top: 25px;
            }
            #desktop-action-buttons .action-btn {
                flex-grow: 0;
                flex-basis: 160px;
            }

            #host-message-desktop { margin: 20px auto 0 auto; }

            #host-message { display: none; }
            #host-message-desktop { display: flex; }
            
            #action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div id="logo-container">
            <svg id="logo-svg" viewBox="0 0 100 100">
                <defs>
                    <linearGradient id="rimGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#E0E0E0"/>
                        <stop offset="50%" stop-color="#BDBDBD"/>
                        <stop offset="100%" stop-color="#9E9E9E"/>
                    </linearGradient>
                    <linearGradient id="bladeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                         <stop offset="0%" stop-color="#FFC107" />
                         <stop offset="100%" stop-color="#F44336" />
                    </linearGradient>
                     <filter id="logoGlow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blur"/>
                        <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.7 0" result="glow"/>
                        <feComposite in="glow" in2="SourceGraphic" operator="over"/>
                    </filter>
                </defs>

                <circle cx="50" cy="50" r="48" fill="#212121" />
                <circle cx="50" cy="50" r="42" fill="url(#rimGradient)" />
                <circle cx="50" cy="50" r="40" fill="#37474F" />

                <g filter="url(#logoGlow)">
                    <path id="blade" d="M 50 48 C 65 45, 75 30, 80 15 C 70 30, 60 43, 50 46 Z" fill="url(#bladeGradient)"/>
                    <use href="#blade" transform="rotate(72, 50, 50)" />
                    <use href="#blade" transform="rotate(144, 50, 50)" />
                    <use href="#blade" transform="rotate(216, 50, 50)" />
                    <use href="#blade" transform="rotate(288, 50, 50)" />
                </g>

                <circle cx="50" cy="50" r="18" fill="#424242" />
                <circle cx="50" cy="50" r="15" fill="#616161" />
                <circle cx="50" cy="50" r="5" fill="#FFC107" />
            </svg>
        </div>
        <h1 id="game-title">P√∂rgesd Fel!</h1>
        <h2 id="sunday-title">Pr√©mium Vas√°rnap</h2>
    </header>
    <div id="tv-container">
        <div id="screen">
            <div id="game-area">
                <section id="puzzle-section">
                    <div id="puzzle-category-wrapper">
                        <div id="lotto-bajnok-icon">üçÄ</div>
                        <div id="puzzle-category"></div>
                    </div>
                    <div id="free-vowel-indicator">Ingyen Mag√°nhangz√≥d Van!</div>
                    <div id="round-info-container">
                        <div id="round-display"></div>
                        <div id="hour-block-display"></div>
                    </div>
                    <div id="copyright-notice">¬© Copyright by: Robi - P√∂rgesd Fel! Edition</div>
                    <div id="puzzle-board"></div>
                    <div id="auto-hints-container"></div>
                    <div id="alphabet-panel"></div>
                    <div id="desktop-action-buttons">
                        <button id="solve-button-desktop" class="action-btn solve-btn">Megfejtem</button>
                        <button id="transfer-button-desktop" class="action-btn transfer-btn">√Åtutal√°s</button>
                        <button id="lotto-button-desktop" class="action-btn lotto-btn">Napi Lott√≥</button>
                        <button id="nyero21-button-desktop" class="action-btn nyero21-btn">Nyer≈ë21</button>
                    </div>
                    <div id="host-message-desktop" class="host-message-style"></div>
                </section>
                <section id="game-controls-section">
                    <div id="player-info-wrapper">
                        <div id="main-prize-progress"></div>
                        <div id="all-huds-container">
                            <div id="main-hud" class="player-hud">
                                <div class="hud-label"><span id="millionaire-icon">üëë</span><span id="main-hud-label">√ñsszes Zseton</span></div>
                                <div id="score-display">0 Ft</div>
                            </div>
                            <div id="hourly-hud" class="player-hud">
                                <div class="hud-label">Aktu√°lis menet</div>
                                <div id="hourly-winnings-display">0 Ft</div>
                            </div>
                             <div id="round-winnings-hud" class="player-hud">
                                <div class="hud-label">Ebben a k√∂rben</div>
                                <div id="round-winnings-display">0 Ft</div>
                            </div>
                             <div id="lotto-prize-hud" class="player-hud" style="display: none;">
                                <div class="hud-label">‚òòÔ∏è Akt√≠v B√≥nuszok</div>
                                <div id="lotto-prize-label">Megtekint√©s</div>
                                <div id="lotto-prize-count">0</div>
                            </div>
                            <div id="prize-chest-hud" class="player-hud" style="display: none;">
                                <div class="hud-label">
                                   <svg class="prize-chest-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 8H4C2.89543 8 2 8.89543 2 10V18C2 19.1046 2.89543 20 4 20H20C21.1046 20 22 19.1046 22 18V10C22 8.89543 21.1046 8 20 8Z" fill="#a97e41"/>
                                    <path d="M20 8H4C2.89543 8 2 8.89543 2 10V18C2 19.1046 2.89543 20 4 20H20C21.1046 20 22 19.1046 22 18V10C22 8.89543 21.1046 8 20 8Z" stroke="#6e5127" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M16 8V6C16 4.89543 15.1046 4 14 4H10C8.89543 4 8 4.89543 8 6V8" stroke="#6e5127" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 12V16" stroke="#6e5127" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M3 14H21" stroke="#d4ac0d" stroke-width="1.5"/>
                                    </svg>
                                    <span>Nyerem√©nyl√°da</span>
                                </div>
                                <div id="prize-chest-label">Megtekint√©s</div>
                                <div id="prize-chest-count">0</div>
                            </div>
                        </div>
                        <div id="won-prize-container">
                            <div class="prize-label">Bezsebelt extra</div>
                            <div id="won-prize-name" class="prize-name"></div>
                        </div>
                    </div>
                    <div id="game-interaction-wrapper">
                        <div id="wheel-wrapper">
                            <button id="wheel-center-button">
                                <svg id="booster-svg" viewBox="0 0 100 100">
                                    <circle class="booster-bg" cx="50" cy="50" r="45"></circle>
                                    <circle class="booster-bar" cx="50" cy="50" r="45" transform="rotate(-90 50 50)"></circle>
                                </svg>
                                <span id="wheel-center-text">P√∂rget</span>
                            </button>
                            <div id="wheel-pointer"></div>
                            <svg id="wheel" viewBox="0 0 100 100"></svg>
                        </div>
                        <div id="power-meter-container">
                            <div id="power-meter-bar"></div>
                        </div>
                        <div id="host-message" class="host-message-style">Hell√≥ a st√∫di√≥ban! Kezd√©shez k√ºldj meg egy p√∂rget√©st!</div>
                        <div id="action-buttons">
                            <button id="spin-button" class="action-btn">P√∂rget√©s</button>
                            <button id="solve-button" class="action-btn solve-btn">Megfejtem</button>
                            <button id="transfer-button" class="action-btn transfer-btn">√Åtutal√°s</button>
                            <button id="lotto-button" class="action-btn lotto-btn">Napi Lott√≥</button>
                            <button id="nyero21-button" class="action-btn nyero21-btn">Nyer≈ë21</button>
                            <button id="new-game-button" class="action-btn">√öj J√°t√©k</button>
                            <button id="skip-error-btn" class="action-btn">Hiba √Åtugr√°sa</button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <div id="rules-container">
        <h2>J√°t√©kszab√°lyok</h2>
        <ul>
            <li class="goal"><strong>C√©l:</strong> Gy≈±jtsd a legt√∂bb zsetont a feladv√°nyok megfejt√©s√©vel! P√∂rgess a szerencseker√©ken, tippelj bet≈±ket, √©s fejtsd meg a rejtv√©nyt, miel≈ëtt cs≈ëdbe m√©sz!</li>
            <li class="gameplay"><strong>J√°t√©kmenet:</strong> Minden √≥r√°ban 10, egyre nehezed≈ë feladv√°ny v√°r. P√∂rgess a ker√©ken, ami meghat√°rozza a k√∂vetkez≈ë m√°ssalhangz√≥-tipped √©rt√©k√©t. Ha a bet≈± szerepel a t√°bl√°n, annyiszor kapod meg a p√∂rgetett √∂sszeget, ah√°nyszor a bet≈± el≈ëfordul. A k√∂rben gy≈±jt√∂tt zsetonjaidb√≥l v√°s√°rolhatsz mag√°nhangz√≥t (az √°ruk egyre n≈ë), vagy megk√≠s√©relheted a megfejt√©st, ami√©rt extra b√≥nusz zseton j√°r.</li>
            <li class="lotto"><strong>Napi Lott√≥:</strong> Minden nap este 7-ig v√°s√°rolhatsz lott√≥szelv√©nyt a megnyert zsetonjaidb√≥l. Adj meg <strong>5 sz√°mot a 45-b≈ël!</strong> A sorsol√°s minden este 7-kor t√∂rt√©nik. A nyerem√©nyek a tal√°latok sz√°m√°t√≥l f√ºggnek, √©s a Nyerem√©nyl√°d√°dba ker√ºlnek, ahonnan aktiv√°lhatod ≈ëket. A nyerem√©nyek lehetnek t√∂bb napig vagy ak√°r a h√©t v√©g√©ig tart√≥ b√≥nuszok, mint p√©ld√°ul CS≈êD-v√©delem, dupla p√©nz, vagy a f≈ënyerem√©ny, a Lott√≥Bajnok c√≠m!</li>
            <li class="dynamic-wheel"><strong>Dinamikus Ker√©k:</strong> A ker√©k tartalma minden fordul√≥ban v√°ltozhat! Ahogy haladsz el≈ëre, egyre nagyobb nyerem√©nyek, de √∫j mez≈ëk is megjelennek. Ilyenek p√©ld√°ul a <strong>CS≈êD</strong> (elveszti a k√∂r√∂s p√©nzed), <strong>Felez≈ë</strong> (felezi a k√∂r√∂s p√©nzed), <strong>Dupla vagy Semmi</strong> (kock√°ztathatod a k√∂r√∂s p√©nzed egy bet≈±tippel), <strong>K√ºl√∂nd√≠j</strong> (√©rt√©kes t√°rgynyerem√©ny vagy annak p√©nzbeli megfelel≈ëje), √©s a <strong>Meglepet√©s</strong> (egy v√©letlenszer≈± pozit√≠v vagy negat√≠v esem√©ny).</li>
            <li class="minigame"><strong>Nyer≈ë21 Minij√°t√©k:</strong> Ha √©pp nem te p√∂rgetsz, vagy csak egy kis extra izgalomra v√°gysz, pr√≥b√°ld ki a Nyer≈ë21-et! Tegy√©l fel a zsetonjaidb√≥l, √©s h√∫zz lapokat egy 10 lapos (2-11 √©rt√©k≈±) paklib√≥l. Ha a lapjaid √∂sszege el√©ri a 21-et, a t√©ted √∂tsz√∂r√∂s√©t nyered! Ha az √∂sszeg 18 √©s 20 k√∂z√∂tt van, a t√©ted dupl√°ja j√°r vissza. De vigy√°zz, ha t√∫ll√©ped a 21-et, a t√©t elv√©sz! √ìr√°nk√©nt korl√°tozott sz√°mban j√°tszhatsz.</li>
            <li class="prizes"><strong>B√≥nuszok √©s Nyerem√©nyek:</strong> A j√°t√©k sor√°n t√∂bbf√©le b√≥nuszt szerezhetsz. A Lott√≥n nyert jutalmak a <strong>Nyerem√©nyl√°d√°ba</strong> ker√ºlnek, ahonnan manu√°lisan kell aktiv√°lnod ≈ëket. Az aktiv√°lt b√≥nuszok egy ideig (pl. 24 √≥r√°ig vagy a h√©t v√©g√©ig) extra el≈ëny√∂ket adnak. A ker√©ken p√∂rgethet≈ë <strong>K√ºl√∂nd√≠j</strong> pedig egy azonnali v√°laszt√°si lehet≈ës√©get k√≠n√°l egy √©rt√©kes t√°rgy √©s a k√©szp√©nz k√∂z√∂tt.</li>
            <li class="week"><strong>Heti Kassza:</strong> Minden, amit h√©tk√∂znap (h√©tf≈ët≈ël szombatig) nyersz, a Heti Kassz√°dba ker√ºl. Ezt a p√©nzt vas√°rnap teszed kock√°ra.</li>
            <li class="sunday"><strong>Pr√©mium Vas√°rnap:</strong> Vas√°rnap a Heti Kassz√°db√≥l tett t√©tekkel j√°tszsol. Minden vas√°rnapi feladv√°ny el≈ëtt a Heti Kassz√°db√≥l kell t√©tet megtenned. A c√©l, hogy a nap v√©g√©re min√©l t√∂bbet gy≈±jts √©s elnyerd a <strong>H√©t Milliomosa</strong> c√≠met!</li>
            <li class="main-prize"><strong>F≈ëd√≠j J√°t√©k:</strong> Ha egy √≥r√°s j√°t√©kblokk v√©g√©re (a 10. feladv√°ny ut√°n) legal√°bb 150.000 Ft-ot gy≈±jt√∂tt√©l az adott √≥r√°ban, es√©lyt kapsz a F≈ëd√≠j J√°t√©kra! Itt az √≥ra alatt gy≈±jt√∂tt teljes p√©nzedet kock√°ztatva, egyetlen f≈ëd√≠j-feladv√°ny megfejt√©s√©vel megdupl√°zhatod azt! A j√°t√©khoz ki kell v√°lasztanod 5 m√°ssalhangz√≥t √©s 1 mag√°nhangz√≥t, majd 30 m√°sodperced van a megfejt√©sre. Ha nem gy≈±lt √∂ssze a limit, de a teljes vagyonodb√≥l ki tudod p√≥tolni a hi√°nyz√≥ √∂sszeget, akkor is j√°tszhatsz.</li>
            <li class="millionaire"><strong>A H√©t Milliomosa:</strong> Az a j√°t√©kos, aki a vas√°rnapi j√°t√©k v√©g√©re a legmagasabb egyenleggel z√°r (minimum 1.000.000 Ft felett), elnyeri "A H√©t Milliomosa" c√≠met. Ez a c√≠m a teljes k√∂vetkez≈ë h√©tre exkluz√≠v b√≥nuszokat √©s el≈ëny√∂ket biztos√≠t sz√°m√°ra a j√°t√©kban.</li>
            <li class="exit"><strong>Kil√©p√©s:</strong> Ha egy √≥r√°n bel√ºl kil√©psz a j√°t√©kb√≥l, majd visszat√©rsz, a m√°sodik kil√©p√©sn√©l az adott √≥r√°ban szerzett √∂sszes nyerem√©nyed elv√©sz. Gondold meg j√≥l!</li>
        </ul>
    </div>


    <!-- Mod√°lis ablakok -->

    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="custom-modal-title">Megfejt√©s</h3>
            <p id="custom-modal-text">Na, mi a megfejt√©s?</p>
            <input id="solve-input" type="text" class="modal-input" placeholder="√çRD BE A MEGFEJT√âST...">
            <div class="modal-buttons" id="custom-modal-buttons"></div>
        </div>
    </div>
    
    <div id="dev-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Fejleszt≈ëi Men√º</h3>
            <div id="dev-options">
                <button id="dev-force-main-prize" class="modal-btn confirm">F≈ëd√≠j J√°t√©k Teszt</button>
                <button id="dev-test-lotto" class="modal-btn lotto-btn">Napi Lott√≥ Teszt</button>
                <button id="dev-test-nyero21" class="modal-btn nyero21-btn">Nyer≈ë21 Teszt</button>
            </div>
            <div class="modal-buttons">
                 <button id="dev-modal-close-btn" class="modal-btn cancel">Bez√°r√°s</button>
            </div>
        </div>
    </div>
    
    <div id="main-prize-modal">
         <span class="dev-mode-indicator" style="display: none;">TESZT M√ìD</span>
         <h2 id="main-prize-title">F≈ëd√≠j J√°t√©k</h2>
         <h3 id="main-prize-category">F≈ëd√≠j Kateg√≥ria</h3>
         <div id="main-prize-board"></div>
         <p id="main-prize-given-letters"></p>
         <p id="main-prize-final-answer" style="display: none;"></p>
         <div id="main-prize-timer">30.0</div>
         <p id="main-prize-instructions">√çrd be a megfejt√©st, miel≈ëtt lej√°r az id≈ë!</p>
         <div id="main-prize-alphabet-panel-container"></div>
         <input id="main-prize-solve-input" type="text" class="modal-input" placeholder="MEGFEJT√âS">
         <div class="modal-buttons">
            <button id="main-prize-select-confirm-btn" class="modal-btn confirm">Bet≈±k lez√°r√°sa</button>
            <button id="main-prize-confirm-btn" class="modal-btn confirm">Megfejtem!</button>
            <button id="main-prize-close-btn" class="modal-btn cancel" style="display: none;">Bez√°r√°s</button>
         </div>
    </div>

    <div id="nyero21-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="nyero21-content-wrapper">
                 <span class="dev-mode-indicator" style="display: none;">TESZT M√ìD</span>
                 <svg id="nyero21-table-svg" viewBox="0 0 200 120" preserveAspectRatio="none">
                    <defs>
                        <radialGradient id="tableGrad" cx="50%" cy="50%" r="70%" fx="50%" fy="50%">
                            <stop offset="0%" style="stop-color:rgb(0,80,0);stop-opacity:1" />
                            <stop offset="100%" style="stop-color:rgb(0,40,0);stop-opacity:1" />
                        </radialGradient>
                    </defs>
                    <ellipse cx="100" cy="60" rx="100" ry="60" fill="url(#tableGrad)"/>
                    <path d="M 10 60 Q 100 -10 190 60" stroke="#a97e41" stroke-width="5" fill="none" />
                </svg>
                <img id="nyero21-joker" src="https://assets.codepen.io/1506195/joker-card.svg" alt="Joker">
                <h3 style="color:white;">Nyer≈ë21</h3>
                <div id="nyero21-staking-area">
                    <p>Tedd meg a t√©tet a Nyer≈ë21 j√°t√©khoz! A c√©l 21-et el√©rni, de nem t√∫ll√©pni. A 21-es lap√©rt a t√©t 5x-√∂se, 18-20-ig a t√©t dupl√°ja j√°r vissza.</p>
                    <p>Jelenlegi egyenleg: <strong id="nyero21-player-balance">0 Ft</strong></p>
                    <p id="nyero21-plays-left"></p>
                    <input id="nyero21-stake-input" type="number" class="modal-input" placeholder="T√©t √∂sszege">
                    <div class="modal-buttons">
                        <button id="nyero21-start-game-btn" class="modal-btn confirm">J√°t√©k ind√≠t√°sa</button>
                        <button id="nyero21-cancel-btn" class="modal-btn cancel">M√©gse</button>
                    </div>
                </div>
                <div id="nyero21-game-area">
                    <div id="nyero21-info-bar"></div>
                    <div id="nyero21-card-deck"></div>
                    <div id="nyero21-player-hand">
                        <p>Pontsz√°mod:</p>
                        <div id="nyero21-player-score">0</div>
                    </div>
                    <div id="nyero21-result-message"></div>
                    <div class="modal-buttons">
                         <button id="nyero21-hit-btn" class="modal-btn confirm">Lapok k√∂z√ºl v√°lasztok</button>
                         <button id="nyero21-stand-btn" class="modal-btn" style="background-color: var(--accent-teal); color: white;">Meg√°llok</button>
                         <button id="nyero21-new-game-btn" class="modal-btn confirm">√öj J√°t√©k</button>
                         <button id="nyero21-close-btn" class="modal-btn cancel">Bez√°r√°s</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="lotto-modal" class="modal-overlay">
        <div class="modal-content">
             <div id="lotto-content-wrapper">
                 <span class="dev-mode-indicator" style="display: none;">TESZT M√ìD</span>
                 <h3 id="lotto-title">Napi Lott√≥</h3>
                 <div id="lotto-info-area">
                    <p id="lotto-status-text"></p>
                    <div id="lotto-drawing-container">
                        <p id="lotto-drawing-date"></p>
                        <div id="lotto-winning-numbers" class="lotto-ball-wrapper"></div>
                    </div>
                    <div id="lotto-submitted-tickets"></div>
                     <div class="modal-buttons">
                        <button id="lotto-buy-ticket-btn" class="modal-btn lotto-btn">√öj szelv√©ny</button>
                        <button id="lotto-cancel-btn" class="modal-btn cancel">Bez√°r√°s</button>
                    </div>
                 </div>
                 <div id="lotto-betting-area" style="display: none;">
                    <svg id="lotto-ticket-svg" viewBox="0 0 100 150" preserveAspectRatio="none"><path d="M0 5 Q 0 0 5 0 H95 Q 100 0 100 5 V145 Q 100 150 95 150 H5 Q 0 150 0 145 V5 Z" fill="#E8EAF6" stroke="#BDBDBD" stroke-width="0.5"></path><path d="M0 40 L100 40 M20 0 V40 M80 0 V40" stroke="#CFD8DC" stroke-width="0.5" stroke-dasharray="2"></path></svg>
                    <div id="lotto-ticket-content">
                        <p>V√°lassz ki 5 sz√°mot a 45-b≈ël! <br><span id="lotto-cost-text">A szelv√©ny √°ra: <strong>5.000 Ft</strong></span></p>
                        <div id="lotto-selected-display">Nyer≈ësz√°maid: -</div>
                        <div id="lotto-grid"></div>
                        <div class="modal-buttons">
                            <button id="lotto-submit-btn" class="modal-btn confirm" disabled>Szelv√©ny felad√°sa</button>
                            <button id="lotto-cancel-bet-btn" class="modal-btn cancel">Vissza</button>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
    </div>
    
    <div id="active-bonuses-modal" class="modal-overlay">
         <div class="modal-content">
             <div id="bonuses-content-wrapper">
                 <h3>Akt√≠v B√≥nuszok</h3>
                 <ul id="active-bonuses-list"></ul>
                 <div class="modal-buttons">
                    <button id="active-bonuses-close-btn" class="modal-btn cancel">Bez√°r√°s</button>
                 </div>
             </div>
        </div>
    </div>
    
    <div id="prize-chest-modal" class="modal-overlay">
        <div class="modal-content">
             <div id="chest-content-wrapper">
                 <h3>Nyerem√©nyl√°da</h3>
                 <p>Itt tal√°lod a lott√≥n vagy m√°s m√≥don nyert, aktiv√°l√°sra v√°r√≥ b√≥nuszaidat.</p>
                 <ul id="prize-chest-list"></ul>
                 <div class="modal-buttons">
                    <button id="prize-chest-close-btn" class="modal-btn cancel">Bez√°r√°s</button>
                 </div>
             </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
          const allPuzzles = [
  
    { "category": "F√∂ldrajz", "puzzle": "A DUNA-DELTA", "hints": ["A Duna Fekete-tengeri torkolatvid√©ke.", "A Vil√°g√∂r√∂ks√©g r√©sze."] },
    { "category": "Sorozat", "puzzle": "BREAKING BAD - TOT√ÅL SZ√çV√ÅS", "hints": ["Egy k√©miatan√°rr√≥l sz√≥l, aki drogf≈ëz√©sre adja a fej√©t.", "Walter White √°talakul√°sa a k√∂zponti t√©ma."] },
    { "category": "Sport√°g", "puzzle": "CSELG√ÅNCS (JUDO)", "hints": ["Jap√°n eredet≈± k√ºzd≈ësport.", "'A l√°gy √∫t' a jelent√©se."] },
    
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "ADDIG J√ÅR A KORS√ì A K√öTRA M√çG EL NEM T√ñRIK", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "NEM MIND ARANY AMI F√âNYLIK", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "JOBB F√âLNI MINT MEGIJEDNI", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AKI M√ÅSNAK VERMET √ÅS MAGA ESIK BELE", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "KICSI A BORS DE ER≈êS", hint: "Sz√≥l√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AJ√ÅND√âK L√ìNAK NE N√âZD A FOG√ÅT", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "SOK L√öD DISZN√ìT GY≈êZ", hint: "K√∂zmond√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "BAGOLY MONDJA VER√âBNEK HOGY NAGYFEJ≈∞", hint: "Sz√≥l√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "RELATIVIT√ÅSELM√âLET", hint: "Tudom√°nyos elm√©let" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "DEZOXIRIBONUKLEINSAV", hint: "Biol√≥giai szakkifejez√©s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "FOTOSZINT√âZIS", hint: "Biol√≥giai folyamat" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "NAGY HADRON√úTK√ñZTET≈ê", hint: "Tudom√°nyos l√©tes√≠tm√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "GRAVIT√ÅCI√ìS HULL√ÅMOK", hint: "Fizikai jelens√©g" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "MESTERS√âGES INTELLIGENCIA", hint: "Technol√≥giai fogalom" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "KVANTUMSZ√ÅM√çT√ìG√âP", hint: "Technol√≥giai eszk√∂z" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "PERI√ìDUSOS RENDSZER", hint: "K√©miai fogalom" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "H√ÅBOR√ö √âS B√âKE", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A NYOMORULTAK", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "B≈∞N √âS B≈∞NH≈êD√âS", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "SZ√ÅZ √âV MAG√ÅNY", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AZ ISTENI SZ√çNJ√ÅT√âK", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "DON QUIJOTE DE LA MANCHA", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "MOBY DICK A FEH√âR B√ÅLNA", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A LEGYEK URA", hint: "Irodalmi m≈±" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AMAZONASI ES≈êERD≈ê", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "MARIANNA-√ÅROK", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "NAGY-KORALLZ√ÅTONY", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "SZAHARA SIVATAG", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "GAL√ÅPAGOS-SZIGETEK", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AURORA BOREALIS", hint: "Term√©szeti jelens√©g" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "VIKT√ìRIA-V√çZES√âS", hint: "F√∂ldrajzi hely" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "CSENDES-√ìCE√ÅNI T≈∞ZGY≈∞R≈∞", hint: "F√∂ldrajzi jelens√©g" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A NORMANDIAI PARTRSZ√ÅLL√ÅS", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A BERLINI FAL LEOMBL√ÅSA", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A NAGY FRANCIA FORRADALOM", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A R√ìMAI BIRODALOM BUK√ÅSA", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A REFORM√ÅCI√ì KEZDETE", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A TIZENH√ÅROM GYARMAT F√úGGETLENS√âGE", hint: "T√∂rt√©nelmi esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A SZIKSZTUSZI K√ÅPOLNA MENNYEZETE", hint: "M≈±alkot√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "LEONARDO DA VINCI MONA LISA", hint: "M≈±alkot√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "P√ÅRIZSI NOTRE-DAME SZ√âKESEGYH√ÅZ", hint: "√âp√ºlet" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "AZ UTOLS√ì VACSORA", hint: "M≈±alkot√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A GUERNICA FESTM√âNY PABLO PICASSO", hint: "M≈±alkot√°s" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A VELENCEI KARNEV√ÅL", hint: "Kultur√°lis esem√©ny" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "JAP√ÅN CSERESZNYEVIR√ÅGZ√ÅS", hint: "Term√©szeti jelens√©g" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A CSILLAGOK H√ÅBOR√öJA BALJ√ìS √ÅRNYAK", hint: "Filmc√≠m" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "A GY≈∞R≈∞K URA A KIR√ÅLY VISSZAT√âR", hint: "Filmc√≠m" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "APOKALIPSZIS MOST", hint: "Filmc√≠m" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "BOHEMIAN RHAPSODY A QUEEN EGY√úTTES", hint: "Zenei m≈± / Filmc√≠m" },
    { category: "F≈ëd√≠j Feladv√°ny", puzzle: "WOLFGANG AMADEUS MOZART", hint: "H√≠res szem√©ly" },
            ];

            

           const SPECIAL_PRIZES = [
                { name: '√âves el≈ëfizet√©s egy h√≠rport√°lra', value: 25000 }, { name: 'Elektromos roller', value: 120000 },
                { name: 'K√©t VIP jegy egy koncertre', value: 50000 }, { name: 'Egy rekesz k√©zm≈±ves s√∂r', value: 20000 },
                { name: 'Egy √©vre elegend≈ë √ºd√≠t≈ë', value: 40000 }, { name: 'B√©rlet egy ny√°ri fesztiv√°lra', value: 150000 },
                 { name: 'Egy h√©tv√©ge egy wellness hotelben', value: 130000 },
                { name: 'Profi dr√≥n', value: 180000 },
                { name: 'Okosotthon csomag', value: 250000 },
                { name: 'Gamer laptop', value: 500000 },
                { name: 'Nagyk√©perny≈ës 4K TV', value: 350000 },
                { name: 'Luxus kar√≥ra', value: 450000 },
                { name: 'H≈ël√©gballonos utaz√°s', value: 380000 },
            ];
            
            const wheelSegmentsR1 = [
                { label: '300', value: 300, color: '#4DB6AC' }, { label: 'CS≈êD', value: 'bankrupt', color: '#37474F' },
                { label: '500', value: 500, color: '#F06292' }, { label: '450', value: 450, color: '#7E57C2' },
                { label: 'KIMARADSZ', value: 'lose_turn', color: '#78909C' }, { label: '400', value: 400, color: '#FFB74D' },
                { label: '600', value: 600, color: '#E91E63' }, { label: '+1000', value: 1000, color: '#42A5F5', isBonus: true },
                { label: 'DUPLA/SEMMI', value: 'double_or_nothing', color: '#5C6BC0'}, { label: '700', value: 700, color: '#26C6DA' },
                { label: '550', value: 550, color: '#9CCC65' }, { label: '1000', value: 1000, color: '#FFCA28' }
            ];
            const wheelSegmentsR2 = [
                { label: '600', value: 600, color: '#4DB6AC' }, { label: 'CS≈êD', value: 'bankrupt', color: '#37474F' },
                { label: '800', value: 800, color: '#F06292' }, { label: '1000', value: 1000, color: '#7E57C2' },
                { label: 'KIMARADSZ', value: 'lose_turn', color: '#78909C' }, { label: 'K√úL√ñND√çJ', value: 'special_prize', color: '#B39DDB' },
                { label: '700', value: 700, color: '#FFB74D' }, { label: '+2500', value: 2500, color: '#42A5F5', isBonus: true },
                { label: 'DUPLA/SEMMI', value: 'double_or_nothing', color: '#5C6BC0'}, { label: '900', value: 900, color: '#E91E63' },
                { label: '1200', value: 1200, color: '#9CCC65' }, { label: '2000', value: 2000, color: '#FFCA28' }
            ];
            const wheelSegmentsR3 = [
                { label: '1000', value: 1000, color: '#4DB6AC' }, { label: 'CS≈êD', value: 'bankrupt', color: '#37474F' },
                { label: '1500', value: 1500, color: '#F06292' }, { label: 'DUPLA/SEMMI', value: 'double_or_nothing', color: '#7E57C2' },
                { label: '2500', value: 2500, color: '#78909C' }, { label: 'K√úL√ñND√çJ', value: 'special_prize', color: '#B39DDB' },
                { label: '2000', value: 2000, color: '#FFB74D' }, { label: '1200', value: 1200, color: '#E91E63' },
                { label: '1800', value: 1800, color: '#9CCC65' }, { label: '+5000', value: 5000, color: '#42A5F5', isBonus: true },
                { label: '3000', value: 3000, color: '#D4E157' }, { label: '5000', value: 5000, color: '#FFEE58' }
            ];
            
            const PUZZLES_PER_HOUR = 10;
            const VOWELS = "A√ÅE√âI√çO√ì√ñ≈êU√ö√ú≈∞";
            const FULL_ALPHABET = "A√ÅBCDE√âFGHI√çJKLMNO√ì√ñ≈êPQRSTU√ö√ú≈∞VWXYZ";
            const SOLVE_BONUSES = [5000, 7000, 10000, 10000, 12000, 12000, 15000, 15000, 15000, 25000];
            const HUGE_WIN_THRESHOLD = 4000;
            const MILLIONAIRE_THRESHOLD = 1000000;
            const MAIN_PRIZE_THRESHOLD = 150000;
            const MAIN_PRIZE_TIME = 30;
            const MINIGAME_PLAYS_PER_HOUR = 10;
            const LOTTO_COST = 5000;
            const MAX_LOTTO_TICKETS_PER_DAY = 5;
            const LOTTO_NUM_RANGE = 45;
            const LOTTO_PRIZES = {
                1: { id: 'one_hit_wonder', name: '1 Tal√°lat B√≥nusz', duration: '24h', description: '24 √≥r√°s CS≈êD v√©delem + 1 ingyen mag√°nhangz√≥ minden feladv√°nyban.' },
                2: { id: 'two_hit_reveal', name: 'K√∂nny√≠tett Kezd√©s', duration: 'weekly', description: 'A h√©t v√©g√©ig 2 aj√°nd√©k bet≈± a 8 karaktern√©l hosszabb feladv√°nyokn√°l.' },
                3: { id: 'three_hit_boost', name: 'Dupl√°z√≥ B√≥nusz', duration: '24h', description: '24 √≥r√°s dupla m√°ssalhangz√≥-p√©nz + 2 ingyen mag√°nhangz√≥ minden feladv√°nyban.' },
                4: { id: 'four_hit_no_bankrupt', name: 'Teljes V√©delem', duration: 'weekly', description: 'A h√©t v√©g√©ig nincs CS≈êD mez≈ë a ker√©ken.' },
                5: { id: 'lotto_bajnok', name: 'Lott√≥Bajnok Jackpot', duration: 'weekly', description: 'A h√©t v√©g√©ig tart√≥ Jackpot: 100.000 Ft azonnali jutalom, minden feladv√°ny Arany Fordul√≥, √©s minden seg√≠ts√©g ingyenes!' }
            };

            
            const HOST_MESSAGES = {
                power_up: ["Mutasd a flow-t! Min√©l er≈ësebb a p√∂rget√©s, ann√°l nagyobb a nyerem√©ny!", "Adj bele mindent! P√∂rgess √∫gy, mintha nem lenne holnap!", "Na l√°ssuk, mekkora vibe van a csukl√≥dban! K√ºldd meg!", "Ideje megmutatni, ki a f≈ën√∂k! Adj neki kaka√≥t!", "Engedd szabadj√°ra az energi√°t! P√∂rgess√ºnk nagyot!"],
                start_game: ["Hell√≥, hell√≥! √údv a st√∫di√≥ban, ahol a bet≈±k p√©nzt √©rnek! Kezd≈ëdj√∂n a m√≥ka!", "Szevasztok, arcok! K√©szen √°lltok a p√∂rget√©sre? L√°ssuk, mit rejt az els≈ë feladv√°ny!", "Cs≈ëv√°z, nagy j√°t√©kos! Induljon a zsetonvad√°szat! Az els≈ë feladv√°ny m√°r v√°r!", "Beker√ºlt√©l a k√∂rforg√°sba! Itt az id≈ë, hogy megp√∂rgesd a szerencs√©det. L√°ssuk a t√°bl√°t!", "Sziasztok, P√∂rget≈ëk! A st√∫di√≥ f√©nyei r√°tok szegez≈ëdnek. Kezdj√ºk is!"],
                start_round: ["√öj k√∂r, √∫j es√©lyek! A feladv√°ny friss √©s ropog√≥s, mint egy meleg p√©k√°ru.", "√âs m√°r j√∂n is a k√∂vetkez≈ë menet! A neh√©zs√©gi szint emelkedik, de a nyerem√©ny is!", "Felk√©sz√ºlni, vigy√°zz... √∫j feladv√°ny! L√°ssuk, ez kifog-e rajtad!", "A t√°bla tiszta, a zsetonok v√°rnak. J√∂het a k√∂vetkez≈ë k√∂r!", "Nem √°llunk meg! Itt a friss feladv√°ny, telis-tele rejtett forintokkal!"],
                spinning: ["A ker√©k forog, a szerencse k√∂zleg! Hol √°ll meg vajon?", "P√∂r√∂g-forog, mint egy macska a l√©zerp√∂tty ut√°n! L√°ssuk, mit fogsz!", "A ker√©k most 'loading...'. Rem√©lj√ºk, valami nagyot t√∂lt be!", "Izgalom a k√∂b√∂n! A ker√©k p√∂r√∂g, a pulzus emelkedik!", "A ker√©knek lelke van, √©s most √©pp a te sorsodr√≥l d√∂nt! Hajr√°!"],
                spin_result: ["<strong>{value} Ft</strong> a t√©t! Ennyib≈ël m√°r kij√∂n egy j√≥fajta pizza. Melyik bet≈±t k√©red?", "Ez egy <strong>{value} Ft</strong>-os k√©rd√©s! Na, melyik m√°ssalhangz√≥ lapul a t√°bl√°n?", "Remek p√∂rget√©s: <strong>{value} Ft</strong>! Ez m√°r egy sz√©p kis zsebp√©nz. J√∂het a bet≈±!", "A ker√©k <strong>{value} Ft</strong>-ot dobott! Most te j√∂ssz, mutasd, mit tudsz!", "Sz√©p fog√°s! <strong>{value} Ft</strong> egyetlen bet≈±√©rt? J√≥l hangzik! Melyik lesz az?"],
                correct_consonant: ["Ott van, nem is egy! Ez a bet≈± annyira telital√°lat, hogy flexelhetn√©l vele!", "Bej√∂tt! T√∂bbsz√∂r is! √ögy potyognak a zsetonok, mint es≈ëben a cseppek!", "Ez az! A t√°bla im√°dja ezt a bet≈±t! √âs a p√©nzt√°rc√°d is im√°dni fogja.", "Bingo! Ez a bet≈± √∫gy kellett ide, mint sivatagba egy poh√°r v√≠z. Gratul√°lok!", "T√∂k√©letes! Ez a bet≈± annyira a hely√©n van, mint a hab a tort√°n. Zsebeld be a l√≥v√©t!"],
                bankrupt: ["Jaj, ne! <strong>CS≈êD!</strong> A k√∂r√∂s zsetonok elsz√°lltak, mint a gyenge wifi-jel.", "Bumm! A fekete lyuk elnyelte a k√∂r√∂s nyerem√©nyed. Sebaj, a k√∂vetkez≈ë k√∂rben visszav√°ghatsz!", "A p√©nz elp√°rolgott... de a tud√°s a ti√©d marad! Fel a fejjel!", "CS≈êD! Ez most f√°jt, mint leg√≥ba l√©pni. De a j√°t√©k megy tov√°bb!", "A k√∂r√∂s p√©nznek annyi. De ne add fel, a nagy fog√°s m√©g h√°travan!"],
                solve_success: ["<strong>MEGFEJT√âS!</strong> Kir√°ly vagy! Agyseb√©sz lehetsz, vagy csak sim√°n zseni? √ñsszesen <strong>{totalGained} Ft</strong> a jutalmad!", "Megvan! Olyan sim√°n lehoztad, mint egy profi! Nyerem√©nyed: <strong>{totalGained} Ft</strong>! Pacsi!", "K√©sz! Ezzel a megfejt√©ssel be√≠rtad magad a nagyk√∂nyvbe! <strong>{totalGained} Ft</strong> a jutalom!", "Siker! A st√∫di√≥ felrobbant! <strong>{totalGained} Ft</strong> √ºti a markod! Ez az, gratul√°lok!", "Megfejtve! Ez√©rt a teljes√≠tm√©ny√©rt √≥ri√°si pacsi j√°r! A p√©nz m√°r a ti√©d!"],
                solve_fail: ["Hopp√°, ez mell√©ment! Ez a tipp annyira volt j√≥, mint a papucs a h√≥ban.", "Sajnos nem. De a pr√≥b√°lkoz√°s is sz√°m√≠t! Csak most √©pp zsetonba ker√ºl...", "Nem tal√°lt! Ez most nem j√∂tt √∂ssze. Sebaj, 'hakuna matata'!", "Ez a megfejt√©s sajnos nem az igazi. A b√ºntet√©s levonva, de a j√°t√©k folytat√≥dik!"],
                double_or_nothing_prompt: ["<strong>DUPLA VAGY SEMMI!</strong> Bev√°llal√≥s vagy? A t√©t a k√∂r√∂s p√©nzed: <strong>{points} Ft</strong>. Mondj egy m√°ssalhangz√≥t!", "Itt a 'mindent vagy semmit' pillanat! Kock√°ztatsz <strong>{points} Ft</strong>-ot? J√∂het a bet≈±!"],
                double_win: ["<strong>DUPLA!</strong> Bej√∂tt a rizik√≥! A b√°trak√© a szerencse, √©s most a zseton is!", "Siker√ºlt! Megdupl√°ztad a p√©nzed! Ez az, ami√©rt meg√©ri j√°tszani!"],
                double_lose: ["<strong>SEMMI!</strong> A szerencse most elment k√°v√©zni. A k√∂r√∂s p√©nz b√°nta.", "Aki mer, az n√©ha vesz√≠t. Ez most egy ilyen pillanat volt. Fel a fejjel!"],
                main_prize_qualified: ["<strong>Gratul√°lok!</strong> Kvalifik√°ltad magad a F≈ëd√≠j J√°t√©kra! M√°r csak egy l√©p√©sre vagy a hatalmas nyerem√©nyt≈ël!", "Fantasztikus! Jogosult vagy a F≈ëd√≠j J√°t√©kra! Itt az es√©ly, hogy igaz√°n nagyot szak√≠ts!"],
                assistance_spin: ["A rendszer s√∫g egy kicsit... A(z) <strong>{letter}</strong> bet≈±vel most nagyot nyerhetsz!", "A <strong>SEG√çTS√âG</strong> meg√©rkezett! Pr√≥b√°lkozz a(z) <strong>{letter}</strong> bet≈±vel! B√≠zz a g√©pben!"],
                halver_spin: ["Jaj, ne! Ez a <strong>FELEZ≈ê!</strong> A k√∂r√∂s p√©nzed fele elment di√©t√°zni.", "A felez≈ë lecsapott! Bosszant√≥, de m√©g √≠gy is maradt mit hazavinni a k√∂rb≈ël."],
                bankrupt_sunday: ["√ì, a v√©gzet vas√°rnap! <strong>CS≈êD!</strong> Nemcsak a k√∂r√∂s nyerem√©ny, de a feltett <strong>{bet}&nbsp;Ft-os t√©t is el√∫szott!</strong> Kem√©ny menet."],
                lose_turn: ["<strong>KIMARADSZ!</strong> Most pihensz egy k√∂rt. Haszn√°ld ki egy kis strat√©giai tervez√©sre!", "Hopp√°, egy kis pihen≈ë! Mindj√°rt √∫jra te j√∂ssz."],
                bonus_points: ["<strong>+{value}&nbsp;FT!</strong> Csak √∫gy, aj√°nd√©kba! Ezt zsebeld is be gyorsan!", "Azonnali <strong>{value} Ft</strong>! Gratul√°lok, ez sz√©pen j√∂tt!"],
                huge_win_consonant: ["Ez igen! Egyetlen bet≈±vel <strong>{earnings}&nbsp;Ft</strong>! Ez a p√∂rget√©s... 'chef's kiss'!", "Hatalmas fog√°s! <strong>{earnings}</strong> forint egy bet≈±vel! Ez m√°r d√∂fi!"],
                correct_vowel: ["Igen, van benne <strong>{count}</strong> darab! A t√°bla a bar√°tod.", "J√≥l sejted, a t√°bl√°n ott vir√≠t <strong>{count}</strong> ilyen bet≈±!"],
                wrong_letter: ["Sajn√°lom, de ez a bet≈± most szabads√°gon van.", "Ez a bet≈± ma nem dolgozik a st√∫di√≥ban. Pr√≥b√°lj egy m√°sikat!", "A bet≈±fal nemet intett. Sebaj, a k√∂vetkez≈ë tuti bej√∂n!"],
                solve_golden_success: ["<strong>ARANY MEGFEJT√âS!</strong> Dupla p√©nz, dupla √∂r√∂m! A k√∂r√∂s nyerem√©ny √©s a b√≥nusz is dupl√°z√≥dik! Hatalmas gratul√°ci√≥, <strong>{totalGained}&nbsp;Ft</strong> a ti√©d!", "Ez az! Megfejtetted az Arany Feladv√°nyt! A jutalom nem marad el, a kassz√°d most k√©tszer hangosabban cs√∂r√∂g: <strong>{totalGained}&nbsp;Ft</strong>!"],
                solve_sunday_success: ["<strong>SIKERES K√ñR!</strong> A <strong>{bet}&nbsp;Ft-os t√©t visszaj√°r</strong>, a k√∂r√∂s nyerem√©ny √©s a b√≥nusz pedig hozz√°ad√≥dik a Heti Kassz√°hoz! √ñsszesen <strong>{totalGained}&nbsp;Ft</strong> a gyarapod√°s!"],
                game_over: ["Az erre az √≥r√°ra sz√°nt j√°t√©k v√©get √©rt. Pihenj egyet, √©s gyere vissza k√©s≈ëbb! V√©gs≈ë egyenleged: <strong>{score}&nbsp;Ft</strong>.", "V√©ge a dalnak m√°ra! A v√©geredm√©ny: <strong>{score}</strong> forint. Sz√©p munka volt, pacsi!"],
                main_prize_win: ["ELK√âPESZT≈ê! MEGVAN! A F≈ëd√≠j a ti√©d! A nyerem√©nyed megdupl√°zva: <strong>{winnings}&nbsp;Ft!</strong> Te vagy a bajnok!", "A st√∫di√≥ felrobbant! Megcsin√°ltad! <strong>{winnings}&nbsp;Ft</strong> a jutalom! √ìri√°si vagy!"],
                main_prize_lose: ["Jaj, ne! Sajnos nem ez volt a helyes megfejt√©s. A F≈ëd√≠j el√∫szott. De sz√©p menet volt id√°ig!", "√ì, milyen k√°r! Ez most nem j√∂tt √∂ssze. De ne cs√ºggedj, a k√∂vetkez≈ë √≥r√°ban √∫jra bizony√≠thatsz!"],
                main_prize_lose_timeout: ["Lej√°rt az id≈ë! √ì, milyen k√°r! Az id≈ë a legnagyobb ellenf√©l. A F≈ëd√≠j sajnos nem lett meg.", "Az √≥ra legy≈ëz√∂tt! A F≈ëd√≠j el√∫szott, de a tapasztalat a ti√©d marad!"],
                turn_end: ["√öjra te j√∂ssz! Mutasd, mi a k√∂vetkez≈ë l√©p√©s!", "Ism√©t ti√©d a terep! P√∂rgess, vagy vegy√©l egy mag√°nhangz√≥t!", "Folytat√≥dhat a menet! Ti√©d a p√°lya!"],
                no_more_consonants: ["Az √∂sszes m√°ssalhangz√≥ elfogyott! Vegy√©l mag√°nhangz√≥t, vagy fejtsd meg! A c√©legyenesben vagy!", "Nincs t√∂bb m√°ssalhangz√≥ a kalapban! M√°r csak a mag√°nhangz√≥k seg√≠thetnek, vagy a zseni√°lis elm√©d!"],
                start_golden_round: ["Vigy√°zat! <strong>‚≠ê ARANY FORDUL√ì!</strong> Most minden nyerem√©ny dupl√°n sz√°m√≠t! Itt az id≈ë nagyot √°lmodni!", "Ez az! Egy <strong>‚≠ê ARANY FORDUL√ì!</strong> Itt igaz√°n meg√©ri kock√°ztatni!"],
                sunday_greeting: ["√údv a Pr√©mium Vas√°rnapban! Itt a heti kassz√°d a t√©t. L√°ssuk, mennyit mersz kock√°ztatni!", "Vas√°rnap van, a nagy fogad√°sok napja! Tedd meg a t√©tet, √©s induljon a j√°t√©k a f≈ëd√≠j√©rt!"],
                quit_warning: ["Vigy√°zat! Ebben az √≥r√°ban m√°r kil√©pt√©l egyszer. Ha most ism√©t kil√©psz, az eddigi nyerem√©nyed elv√©sz!", "M√°sodik es√©ly ebben az √≥r√°ban! Ha most abbahagyod, a jelenlegi gy≈±jt√©sed null√°z√≥dik."],
                free_vowel_spin: ["<strong>INGYEN M√ÅNHANGZ√ì!</strong> Szuper! A k√∂vetkez≈ë mag√°nhangz√≥ a h√°z aj√°nd√©ka!", "Ezt nevezem! Most ingyen vehetsz egy mag√°nhangz√≥t, csak √∫gy, laz√°n!"],
                surprise_spin_money: ["<strong>MEGLEPET√âS!</strong> A ker√©k egy kis b√≥nusszal aj√°nd√©koz meg: <strong>{value} Ft!</strong> Csak √∫gy, mert j√≥ fej.", "Hopp√°, egy kis meglepet√©s! Nyerem√©nyed <strong>{value} Ft!</strong> Ezt zsebeld be!"],
                surprise_spin_vowel: ["<strong>MEGLEPET√âS!</strong> A jutalmad egy ingyen mag√°nhangz√≥! Micsoda szerencse!", "A ker√©k ma b≈ëkez≈±: tess√©k, egy ingyen mag√°nhangz√≥!"],
            };
            
            // SCRIPT
            let gameState;
            let hourlyPuzzleIndices;
            let currentModal = { resolve: null, reject: null };
            let isSunday = new Date().getDay() === 0;
            let mainPrizeTimerInterval;
            let nyero21State = {};
            let lottoState = { selectedNumbers: [] };
            let powerAnimationId = null;
            let isDevModeActive = false;

            const SURPRISE_EVENTS = [
                { id: 'villam_bonusz', text: "MEGLEPET√âS! Vill√°m B√≥nusz! Azonnal kapsz <strong>5,000 Ft</strong>-ot!", execute: (gs) => { gs.roundWinnings += 5000; endTurn(); } },
                { id: 'zseton_eso', text: "MEGLEPET√âS! Zseton Es≈ë! Minden, a t√°bl√°n m√°r felfedett m√°ssalhangz√≥ ut√°n kapsz <strong>500 Ft</strong>-ot!", execute: (gs) => {
                    const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gs.currentRound - 1]].puzzle.toUpperCase();
                    const revealedConsonants = gs.guessedLetters.filter(l => !VOWELS.includes(l) && currentPuzzle.includes(l));
                    const bonus = revealedConsonants.length * 500;
                    if (bonus > 0) {
                        gs.roundWinnings += bonus;
                        updateHostMessage(`Zseton Es≈ë! A ${revealedConsonants.length} felfedett m√°ssalhangz√≥√©rt ${bonus.toLocaleString('hu-HU')} Ft a jutalmad!`, true);
                    }
                    endTurn();
                }},
                { id: 'huseg_bonusz', text: "MEGLEPET√âS! H≈±s√©g B√≥nusz! Az eddigi k√∂r√∂s nyerem√©nyed <strong>10%-√°t</strong> megkapod extrak√©nt!", execute: (gs) => {
                    const bonus = Math.floor(gs.roundWinnings * 0.1);
                    if (bonus > 0) gs.roundWinnings += bonus;
                    endTurn();
                }},
                { id: 'kategoria_bonusz', text: "MEGLEPET√âS! Kateg√≥ria B√≥nusz! A k√∂vetkez≈ë sikeres m√°ssalhangz√≥-tipped a p√∂rgetett √©rt√©k <strong>dupl√°j√°t</strong> √©ri!", execute: (gs) => {
                    gs.isCategoryBonusActive = true;
                    endTurn();
                }},
                { id: 'ingyen_maganhangzo', text: "MEGLEPET√âS! A ker√©k ma b≈ëkez≈±: tess√©k, egy ingyen mag√°nhangz√≥!", execute: (gs) => {
                    gs.hasFreeVowel = true;
                    endTurn();
                }},
                { id: 'csod_vedelem', text: "MEGLEPET√âS! CS≈êD V√©delem! A k√∂vetkez≈ë p√∂rget√©sed sor√°n, ha a CS≈êD mez≈ëre √©rsz, a nyerem√©nyed <strong>biztons√°gban marad!</strong>", execute: (gs) => {
                    gs.hasBankruptProtection = true;
                    endTurn();
                }},
                { id: 'felezo_visszavonas', text: "MEGLEPET√âS! Felez≈ë Visszavon√°s! Ha p√∂rgett√©l m√°r felez≈ët ebben a k√∂rben, most visszakapod az elvesztett √∂sszeget!", execute: (gs) => {
                    if (gs.halverAmountLostThisRound > 0) {
                        gs.roundWinnings += gs.halverAmountLostThisRound;
                        gs.halverAmountLostThisRound = 0;
                    }
                    endTurn();
                }},
                { id: 'ingyen_megfejtes', text: "MEGLEPET√âS! Ingyen Megfejt√©si K√≠s√©rlet! Most b√ºntet√©s n√©lk√ºl tippelhetsz a megold√°sra!", execute: (gs) => {
                    gs.hasFreeSolveAttempt = true;
                    endTurn();
                }},
                { id: 'dupla_bonusz', text: "MEGLEPET√âS! Dupla B√≥nusz! Ha ebben a k√∂rben megfejted a feladv√°nyt, a megfejt√©si b√≥nusz megdupl√°z√≥dik!", execute: (gs) => {
                    gs.isSolveBonusDoubled = true;
                    endTurn();
                }},
                { id: 'lotto_bonusz', text: "MEGLEPET√âS! Lott√≥ B√≥nusz! Kapt√°l egy ingyenes Napi Lott√≥ szelv√©nyt! A k√∂vetkez≈ë lott√≥v√°s√°rl√°sod ingyenes lesz.", execute: (gs) => {
                    gs.hasFreeLottoTicket = true;
                    endTurn();
                }},
                { id: 'rejtelyes_betu', text: "MEGLEPET√âS! Rejt√©lyes Bet≈±! A g√©p v√°laszt egy m√°ssalhangz√≥t. Ha szerepel a t√°bl√°n, minden darab√©rt 1,000 Ft-ot kapsz.", execute: (gs) => {
                    const puzzleStr = allPuzzles[hourlyPuzzleIndices[gs.currentRound - 1]].puzzle.toUpperCase();
                    const unGuessedConsonants = FULL_ALPHABET.split('').filter(char => !VOWELS.includes(char) && !gs.guessedLetters.includes(char));
                    if(unGuessedConsonants.length > 0){
                        const randomLetter = unGuessedConsonants[Math.floor(Math.random() * unGuessedConsonants.length)];
                        const foundCount = (puzzleStr.match(new RegExp(randomLetter, "g")) || []).length;
                        if (foundCount > 0) {
                             const bonus = foundCount * 1000;
                             gs.roundWinnings += bonus;
                             updateHostMessage(`A rejt√©lyes bet≈± a(z) <strong>${randomLetter}</strong> volt! ${foundCount} db van bel≈ële, nyert√©l ${bonus.toLocaleString('hu-HU')} Ft-ot!`, true);
                             gs.guessedLetters.push(randomLetter);
                             revealAndCalculate(randomLetter, false, foundCount, true);
                        } else {
                            updateHostMessage(`A rejt√©lyes bet≈± a(z) <strong>${randomLetter}</strong> volt, de sajnos nincs a feladv√°nyban.`, true);
                            endTurn();
                        }
                    } else { endTurn(); }
                }},
                { id: 'rossz_tanacs', text: "MEGLEPET√âS! A m≈±sorvezet≈ë s√∫g: 'Szerintem a(z) <strong>{letter}</strong> bet≈±vel pr√≥b√°lkozz!' De vajon megb√≠zhatsz benne?", execute: (gs) => {
                    const puzzleStr = allPuzzles[hourlyPuzzleIndices[gs.currentRound - 1]].puzzle.toUpperCase();
                    const notInPuzzle = FULL_ALPHABET.split('').filter(char => !VOWELS.includes(char) && !puzzleStr.includes(char));
                    const letter = notInPuzzle.length > 0 ? notInPuzzle[Math.floor(Math.random() * notInPuzzle.length)] : 'X';
                    updateHostMessage(`MEGLEPET√âS! A m≈±sorvezet≈ë s√∫g: "Szerintem a(z) <strong>${letter}</strong> bet≈±vel pr√≥b√°lkozz!" De vajon megb√≠zhatsz benne?`, true);
                    endTurn();
                }},
                { id: 'kockadobas', text: "MEGLEPET√âS! Kockadob√°s! A dobott √©rt√©k 1,000-szerese a jutalmad!", execute: (gs) => {
                    const roll = Math.floor(Math.random() * 6) + 1;
                    const prize = roll * 1000;
                    gs.roundWinnings += prize;
                    updateHostMessage(`A kocka <strong>${roll}</strong>-t mutatott! Nyerem√©nyed: <strong>${prize.toLocaleString('hu-HU')} Ft!</strong>`, true);
                    endTurn();
                }},
                { id: 'azonnali_segitseg', text: "MEGLEPET√âS! Azonnali Seg√≠ts√©g! A g√©p felfedi a k√∂vetkez≈ë rejtett bet≈±t.", execute: (gs) => {
                     const puzzleStr = allPuzzles[hourlyPuzzleIndices[gs.currentRound - 1]].puzzle.toUpperCase();
                     for(const char of puzzleStr) {
                         if (FULL_ALPHABET.includes(char) && !gs.guessedLetters.includes(char)) {
                             gs.guessedLetters.push(char);
                             const foundCount = (puzzleStr.match(new RegExp(char, "g")) || []).length;
                             revealAndCalculate(char, VOWELS.includes(char), foundCount, true);
                             return;
                         }
                     }
                     endTurn();
                }},
                 { id: 'technikai_baki', text: "MEGLEPET√âS! Technikai baki! A ker√©k megakadt, a p√∂rget√©s √©rv√©nytelen. P√∂rgess √∫jra!", execute: (gs) => {
                    setTimeout(togglePowerMeter, 1500);
                }},
                { id: 'mini_csod', text: "MEGLEPET√âS! Mini CS≈êD! Sajnos elvesz√≠ted a k√∂r√∂s nyerem√©nyed <strong>10%</strong>-√°t.", execute: (gs) => {
                    const loss = Math.floor(gs.roundWinnings * 0.1);
                    gs.roundWinnings -= loss;
                    endTurn();
                }},
                { id: 'zarlat_studioban', text: "MEGLEPET√âS! Z√°rlat a st√∫di√≥ban! Ki kell hagynod egy k√∂rt.", execute: (gs) => {
                    endTurn();
                }},
                { id: 'adoellenor', text: "MEGLEPET√âS! Ad√≥ellen≈ër! V√°ratlanul levonnak t≈ëled <strong>1,500 Ft</strong>-ot a k√∂r√∂s nyerem√©nyedb≈ël.", execute: (gs) => {
                    gs.roundWinnings = Math.max(0, gs.roundWinnings - 1500);
                    endTurn();
                }},
                { id: 'tipp_vasarlas', text: "MEGLEPET√âS! K√∂telez≈ë v√°s√°rl√°s! A g√©p vesz neked egy mag√°nhangz√≥t a p√©nzedb≈ël.", execute: (gs) => {
                    const cost = getCurrentVowelCost();
                    if (gs.roundWinnings >= cost && gs.vowelsPurchasedThisRound < 10) {
                         gs.roundWinnings -= cost;
                         gs.vowelsPurchasedThisRound++;
                         updateHostMessage(`MEGLEPET√âS! A g√©p megvette neked a k√∂vetkez≈ë mag√°nhangz√≥t ${cost} Ft-√©rt. Most tippelhetsz egyet ingyen!`, true)
                    } else {
                         updateHostMessage("MEGLEPET√âS! A g√©p venni akart egy mag√°nhangz√≥t, de nincs el√©g p√©nzed r√°. Szerencs√©d volt!", true);
                         endTurn();
                    }
                }},
                { id: 'varatlan_kiadas', text: "MEGLEPET√âS! V√°ratlan kiad√°s! A st√∫di√≥ karbantart√°s√°ra levonnak t≈ëled <strong>1,000 Ft</strong>-ot.", execute: (gs) => {
                    gs.roundWinnings = Math.max(0, gs.roundWinnings - 1000);
                    endTurn();
                }},
            ];
            
            // DOM Elements
            const wheel = document.getElementById('wheel');
            const wheelCenterButton = document.getElementById('wheel-center-button');
            const wheelCenterText = document.getElementById('wheel-center-text');
            const boosterBar = document.querySelector('.booster-bar');
            const solveButton = document.getElementById('solve-button');
            const newGameButton = document.getElementById('new-game-button');
            const skipErrorBtn = document.getElementById('skip-error-btn');
            const nyero21Button = document.getElementById('nyero21-button');
            const lottoButton = document.getElementById('lotto-button');
            const transferButton = document.getElementById('transfer-button');
            const solveButtonDesktop = document.getElementById('solve-button-desktop');
            const nyero21ButtonDesktop = document.getElementById('nyero21-button-desktop');
            const lottoButtonDesktop = document.getElementById('lotto-button-desktop');
            const transferButtonDesktop = document.getElementById('transfer-button-desktop');
            const puzzleBoard = document.getElementById('puzzle-board');
            const puzzleCategory = document.getElementById('puzzle-category');
            const lottoBajnokIcon = document.getElementById('lotto-bajnok-icon');
            const freeVowelIndicator = document.getElementById('free-vowel-indicator');
            const roundInfoContainer = document.getElementById('round-info-container');
            const scoreDisplay = document.getElementById('score-display');
            const hourlyWinningsDisplay = document.getElementById('hourly-winnings-display');
            const roundWinningsDisplay = document.getElementById('round-winnings-display');
            const roundDisplay = document.getElementById('round-display');
            const hourBlockDisplay = document.getElementById('hour-block-display');
            const hostMessageMobile = document.getElementById('host-message');
            const hostMessageDesktop = document.getElementById('host-message-desktop');
            const alphabetPanel = document.getElementById('alphabet-panel');
            const mainHudLabel = document.getElementById('main-hud-label');
            const wonPrizeContainer = document.getElementById('won-prize-container');
            const wonPrizeName = document.getElementById('won-prize-name');
            const autoHintsContainer = document.getElementById('auto-hints-container');
            const modalOverlay = document.getElementById('custom-modal');
            const modalTitle = document.getElementById('custom-modal-title');
            const modalText = document.getElementById('custom-modal-text');
            const modalButtons = document.getElementById('custom-modal-buttons');
            const solveInput = document.getElementById('solve-input');
            const devModal = document.getElementById('dev-modal');
            const devForceMainPrizeBtn = document.getElementById('dev-force-main-prize');
            const devTestLottoBtn = document.getElementById('dev-test-lotto');
            const devTestNyero21Btn = document.getElementById('dev-test-nyero21');
            const devModalCloseBtn = document.getElementById('dev-modal-close-btn');
            const logoContainer = document.getElementById('logo-container');
            const mainPrizeModal = document.getElementById('main-prize-modal');
            const mainPrizeTitle = document.getElementById('main-prize-title');
            const mainPrizeCategory = document.getElementById('main-prize-category');
            const mainPrizeBoard = document.getElementById('main-prize-board');
            const mainPrizeGivenLetters = document.getElementById('main-prize-given-letters');
            const mainPrizeFinalAnswer = document.getElementById('main-prize-final-answer');
            const mainPrizeTimer = document.getElementById('main-prize-timer');
            const mainPrizeInstructions = document.getElementById('main-prize-instructions');
            const mainPrizeSolveInput = document.getElementById('main-prize-solve-input');
            const mainPrizeSelectConfirmBtn = document.getElementById('main-prize-select-confirm-btn');
            const mainPrizeConfirmBtn = document.getElementById('main-prize-confirm-btn');
            const mainPrizeCloseBtn = document.getElementById('main-prize-close-btn');
            const mainPrizeProgress = document.getElementById('main-prize-progress');
            const mainPrizeAlphabetContainer = document.getElementById('main-prize-alphabet-panel-container');
            const nyero21Modal = document.getElementById('nyero21-modal');
            const nyero21StakingArea = document.getElementById('nyero21-staking-area');
            const nyero21GameArea = document.getElementById('nyero21-game-area');
            const nyero21PlayerBalance = document.getElementById('nyero21-player-balance');
            const nyero21StakeInput = document.getElementById('nyero21-stake-input');
            const nyero21PlaysLeft = document.getElementById('nyero21-plays-left');
            const nyero21StartGameBtn = document.getElementById('nyero21-start-game-btn');
            const nyero21CancelBtn = document.getElementById('nyero21-cancel-btn');
            const nyero21InfoBar = document.getElementById('nyero21-info-bar');
            const nyero21CardDeck = document.getElementById('nyero21-card-deck');
            const nyero21PlayerScore = document.getElementById('nyero21-player-score');
            const nyero21ResultMessage = document.getElementById('nyero21-result-message');
            const nyero21HitBtn = document.getElementById('nyero21-hit-btn');
            const nyero21StandBtn = document.getElementById('nyero21-stand-btn');
            const nyero21NewGameBtn = document.getElementById('nyero21-new-game-btn');
            const nyero21CloseBtn = document.getElementById('nyero21-close-btn');
            const lottoModal = document.getElementById('lotto-modal');
            const lottoTitle = document.getElementById('lotto-title');
            const lottoInfoArea = document.getElementById('lotto-info-area');
            const lottoStatusText = document.getElementById('lotto-status-text');
            const lottoCostText = document.getElementById('lotto-cost-text');
            const lottoDrawingContainer = document.getElementById('lotto-drawing-container');
            const lottoDrawingDate = document.getElementById('lotto-drawing-date');
            const lottoWinningNumbers = document.getElementById('lotto-winning-numbers');
            const lottoSubmittedTickets = document.getElementById('lotto-submitted-tickets');
            const lottoBettingArea = document.getElementById('lotto-betting-area');
            const lottoGrid = document.getElementById('lotto-grid');
            const lottoSelectedDisplay = document.getElementById('lotto-selected-display');
            const lottoSubmitBtn = document.getElementById('lotto-submit-btn');
            const lottoBuyTicketBtn = document.getElementById('lotto-buy-ticket-btn');
            const lottoCancelBtn = document.getElementById('lotto-cancel-btn');
            const lottoCancelBetBtn = document.getElementById('lotto-cancel-bet-btn');
            const lottoPrizeHud = document.getElementById('lotto-prize-hud');
            const lottoPrizeCount = document.getElementById('lotto-prize-count');
            const activeBonusesModal = document.getElementById('active-bonuses-modal');
            const activeBonusesList = document.getElementById('active-bonuses-list');
            const activeBonusesCloseBtn = document.getElementById('active-bonuses-close-btn');
            const prizeChestHud = document.getElementById('prize-chest-hud');
            const prizeChestCount = document.getElementById('prize-chest-count');
            const prizeChestModal = document.getElementById('prize-chest-modal');
            const prizeChestList = document.getElementById('prize-chest-list');
            const prizeChestCloseBtn = document.getElementById('prize-chest-close-btn');

            const boosterRadius = 45;
            const circumference = 2 * Math.PI * boosterRadius;
            boosterBar.style.strokeDasharray = circumference;
            boosterBar.style.strokeDashoffset = circumference;
            
            function updateHostMessage(message, isImportant = false) {
                hostMessageMobile.innerHTML = message;
                hostMessageDesktop.innerHTML = message;
                const borderColor = isImportant ? 'var(--accent-gold)' : 'var(--tile-border-color)';
                hostMessageMobile.style.borderColor = borderColor;
                hostMessageDesktop.style.borderColor = borderColor;
            }
            
            function getFormattedDate(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            }
            
            function getWeekNumber(d) {
                d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
                d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
                var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
                var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
                return d.getUTCFullYear() + '-W' + weekNo.toString().padStart(2, '0');
            }

            function loadWeeklyScore() {
                const currentWeek = getWeekNumber(new Date());
                const savedWeek = localStorage.getItem('pordgesdFelWeekId');
                if (currentWeek !== savedWeek) {
                    localStorage.setItem('pordgesdFelWeeklyScore', '0');
                    localStorage.setItem('pordgesdFelWeekId', currentWeek);
                    localStorage.removeItem('quitHourId'); 
                    localStorage.removeItem('nyero21HourId');
                    localStorage.removeItem('pordgesdFelActiveBonuses');
                    localStorage.removeItem('pordgesdFelPrizeInventory');
                }
                return parseInt(localStorage.getItem('pordgesdFelWeeklyScore') || '0', 10);
            }

            function saveWeeklyScore(score) {
                 localStorage.setItem('pordgesdFelWeeklyScore', score.toString());
            }

            function seededRandom(seed) {
                let state = seed;
                return function() {
                    state = (state * 9301 + 49297) % 233280;
                    return state / 233280;
                };
            }

            function getHourlyPuzzles(randomGenerator) {
                const regularPuzzles = allPuzzles.filter(p => p.category !== 'F≈ëd√≠j Feladv√°ny');
                const regularPuzzleIndices = regularPuzzles.map(p => allPuzzles.indexOf(p));
                
                for (let i = regularPuzzleIndices.length - 1; i > 0; i--) {
                    const j = Math.floor(randomGenerator() * (i + 1));
                    [regularPuzzleIndices[i], regularPuzzleIndices[j]] = [regularPuzzleIndices[j], regularPuzzleIndices[i]];
                }
                
                return regularPuzzleIndices.slice(0, Math.min(PUZZLES_PER_HOUR, regularPuzzles.length));
            }
            
            function getRandomMessage(category, replacements = {}) {
                const messages = HOST_MESSAGES[category];
                if (!messages || messages.length === 0) {
                    return `HI√ÅNYZ√ì √úZENET: ${category}`;
                };
                let message = messages[Math.floor(Math.random() * messages.length)];
                for (const key in replacements) {
                    message = message.replace(new RegExp(`{${key}}`, 'g'), replacements[key]);
                }
                return message;
            }

            function resetGameState(isNewGame = false) {
                const oldState = gameState;
                gameState = {
                    playerScore: isNewGame ? loadWeeklyScore() : (oldState ? oldState.playerScore : 0),
                    hourlyWinnings: 0, 
                    roundWinnings: 0,
                    currentRound: 1,
                    totalRounds: PUZZLES_PER_HOUR,
                    puzzleHourId: null,
                    nyero21PlaysThisHour: 0,
                    currentBet: 0,
                    currentSpinValue: null,
                    isSpinning: false,
                    isPoweringUp: false,
                    currentPower: 0,
                    awaitingConsonant: false,
                    isDoubleOrNothingTurn: false,
                    hasFreeVowel: false,
                    inMainPrizeSelection: false,
                    noMoreConsonants: false,
                    guessedLetters: [],
                    mainPrizeConsonants: [],
                    mainPrizeVowels: [],
                    mainPrizeStake: 0,
                    isDevMainPrizeTest: false,
                    specialPrizeWon: false,
                    wonPrizes: [],
                    mainPrizeQualifiedNotified: false,
                    isMillionaire: false,
                    gameInProgress: false,
                    transferUsedThisHour: false,
                    consecutiveWrongConsonants: 0,
                    vowelsPurchasedThisRound: 0,
                    isCategoryBonusActive: false,
                    hasBankruptProtection: false,
                    halverAmountLostThisRound: 0,
                    hasFreeSolveAttempt: false,
                    isSolveBonusDoubled: false,
                    hasFreeLottoTicket: false,
                };
            }

            function setupPuzzleBoard(boardElement, puzzleData) {
                boardElement.innerHTML = '';
                const words = puzzleData.puzzle.toUpperCase().split(' ');
                const rows = [];
                let currentRow = [];
                let currentLength = 0;
                const maxRowLength = window.innerWidth < 480 ? 10 : (window.innerWidth < 901 ? 12 : 16);
                
                words.forEach(word => {
                    if (currentLength + word.length > maxRowLength && currentRow.length > 0) {
                        rows.push(currentRow);
                        currentRow = [];
                        currentLength = 0;
                    }
                    currentRow.push(word);
                    currentLength += word.length + 1;
                });
                rows.push(currentRow);

                rows.forEach(wordArray => {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'puzzle-row';
                    wordArray.forEach((word, wordIndex) => {
                        word.split('').forEach(char => {
                            const tile = document.createElement('div');
                            if (char === ' ') {
                                tile.className = 'puzzle-tile space';
                            } else if (FULL_ALPHABET.includes(char)) {
                                tile.className = 'puzzle-tile';
                                tile.innerHTML = `<div class="tile-inner"><div class="tile-face tile-front"></div><div class="tile-face tile-back">${char}</div></div>`;
                                tile.dataset.letter = char;
                            } else {
                                tile.className = 'puzzle-tile special-char';
                                tile.textContent = char;
                            }
                            rowDiv.appendChild(tile);
                        });
                        
                        if(wordIndex < wordArray.length - 1) {
                             const spaceTile = document.createElement('div');
                             spaceTile.className = 'puzzle-tile space';
                             rowDiv.appendChild(spaceTile);
                        }
                    });
                    boardElement.appendChild(rowDiv);
                });
            }

            function createAlphabetPanel(container = alphabetPanel) {
                container.innerHTML = '';
                FULL_ALPHABET.split('').forEach(letter => {
                    const key = document.createElement('button');
                    key.className = 'alphabet-key';
                    key.textContent = letter;
                    key.dataset.letter = letter;
                    if (VOWELS.includes(letter)) key.classList.add('vowel');
                    key.addEventListener('click', () => handleLetterGuess(letter));
                    container.appendChild(key);
                });
            }
            
            function getCurrentVowelCost() {
                if (isPrizeActive('lotto_bajnok')) return 0;
                let freeVowelsAvailable = 0;
                if(isPrizeActive('one_hit_wonder')) freeVowelsAvailable = 1;
                if(isPrizeActive('three_hit_boost')) freeVowelsAvailable = 2;
                if (gameState.vowelsPurchasedThisRound < freeVowelsAvailable) return 0;
                if (gameState.vowelsPurchasedThisRound < (3 + freeVowelsAvailable)) return 250;
                return 1000;
            }
            
            function updateAlphabetPanel() {
                if (!gameState) return;
                const container = gameState.inMainPrizeSelection ? mainPrizeAlphabetContainer : alphabetPanel;
                document.querySelectorAll('.alphabet-key').forEach(key => {
                    if (!container.contains(key)) return;

                    const letter = key.dataset.letter;
                    const isVowel = VOWELS.includes(letter);
                    let isDisabled = false;

                    if (gameState.inMainPrizeSelection) {
                        const isSelected = gameState.guessedLetters.includes(letter);
                        const consonantsFull = !isVowel && gameState.mainPrizeConsonants.length >= 5;
                        const vowelsFull = isVowel && gameState.mainPrizeVowels.length >= 1;
                        isDisabled = isSelected || consonantsFull || vowelsFull;
                    } else {
                        isDisabled = !gameState.gameInProgress || gameState.guessedLetters.includes(letter) || gameState.isSpinning;
                        if (isVowel) {
                            const cost = getCurrentVowelCost();
                            isDisabled = isDisabled || gameState.awaitingConsonant || gameState.isDoubleOrNothingTurn || (gameState.vowelsPurchasedThisRound >= 10) || (gameState.roundWinnings < cost && !gameState.hasFreeVowel);
                        } else { 
                            isDisabled = isDisabled || (!gameState.awaitingConsonant && !gameState.isDoubleOrNothingTurn);
                        }
                    }
                    key.disabled = isDisabled;
                });
            }
            
            function getSegmentsForRound(round) {
                let baseSegments = wheelSegmentsR1;
                if(round >= 2 && round < 5) baseSegments = wheelSegmentsR2;
                if(round >= 5) baseSegments = wheelSegmentsR3;
                let segments = JSON.parse(JSON.stringify(baseSegments));

                if(round === 3) segments[0] = { label: 'INGYEN M√ÅNHANGZ√ì', value: 'free_vowel', color: '#81C784' };
                if(round === 4) segments[4] = { label: 'SEG√çTS√âG', value: 'assistance', color: '#64B5F6' };
                if(round === 5) segments[8] = { label: 'FELEZ≈ê', value: 'halver', color: 'var(--halver-orange)' };
                if(round === 6) segments[7] = { label: '+10.000', value: 10000, color: '#FFD54F', isBonus: true };
                if(round === 7) segments[4] = { label: '1600', value: 1600, color: '#BA68C8' };
                if(round === 8) segments[3] = { label: 'MEGLEPET√âS', value: 'surprise', color: 'var(--surprise-purple)' };
                if(round === 9) segments = [ { label: 'CS≈êD', value: 'bankrupt', color: '#37474F' }, { label: '7500', value: 7500, color: '#FFEE58' }, { label: 'FELEZ≈ê', value: 'halver', color: 'var(--halver-orange)' }, { label: '1500', value: 1500, color: '#F06292' }, { label: 'K√úL√ñND√çJ', value: 'special_prize', color: '#B39DDB' }, { label: '2500', value: 2500, color: '#9CCC65' }, { label: 'CS≈êD', value: 'bankrupt', color: '#37474F' }, { label: '4000', value: 4000, color: '#D4E157' }, { label: 'DUPLA/SEMMI', value: 'double_or_nothing', color: '#5C6BC0'}, { label: '3000', value: 3000, color: '#FFB74D' }, { label: '+10000', value: 10000, color: '#42A5F5', isBonus: true }, { label: '5000', value: 5000, color: '#E91E63' } ];
                if(round === 10) segments = [ { label: '+10000', value: 10000, color: '#42A5F5', isBonus: true }, { label: '5000', value: 5000, color: '#FFEE58' }, { label: '4500', value: 4500, color: '#BA68C8' }, { label: '3000', value: 3000, color: '#D4E157' }, { label: 'K√úL√ñND√çJ', value: 'special_prize', color: '#B39DDB' }, { label: '4000', value: 4000, color: '#9CCC65' }, { label: 'INGYEN M√ÅNHANGZ√ì', value: 'free_vowel', color: '#81C784' }, { label: '7500', value: 7500, color: '#FFCA28' }, { label: 'SEG√çTS√âG', value: 'assistance', color: '#64B5F6' }, { label: '2500', value: 2500, color: '#FFB74D' }, { label: '+7500', value: 7500, color: '#42A5F5', isBonus: true }, { label: 'MEGLEPET√âS', value: 'surprise', color: 'var(--surprise-purple)' } ];
                
                if (gameState.specialPrizeWon) {
                    const prizeIndex = segments.findIndex(s => s.value === 'special_prize');
                    if (prizeIndex !== -1) segments[prizeIndex] = { label: '2000', value: 2000, color: '#4DB6AC' };
                }
                
                if (isPrizeActive('four_hit_no_bankrupt')) {
                    segments = segments.filter(s => s.value !== 'bankrupt');
                }

                return segments;
            }

             function polarToCartesian(cx, cy, r, angle) {
                const rad = (angle - 90) * Math.PI / 180.0;
                return { x: cx + (r * Math.cos(rad)), y: cy + (r * Math.sin(rad)) };
            }
            
            function drawWheel(round) {
                const segments = getSegmentsForRound(round);
                const numSegments = segments.length;
                wheel.innerHTML = '';
                
                const bgCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                bgCircle.setAttribute("cx", 50);
                bgCircle.setAttribute("cy", 50);
                bgCircle.setAttribute("r", 50);
                bgCircle.setAttribute("fill", "#3F51B5");
                wheel.appendChild(bgCircle);

                for (let i = 0; i < numSegments; i++) {
                    const segment = segments[i];
                    const startAngle = i * (360 / numSegments);
                    const endAngle = (i + 1) * (360 / numSegments);
                    const start = polarToCartesian(50, 50, 50, endAngle);
                    const end = polarToCartesian(50, 50, 50, startAngle);
                    
                    const d = `M ${start.x} ${start.y} A 50 50 0 ${endAngle - startAngle <= 180 ? "0" : "1"} 0 ${end.x} ${end.y} L 50 50 Z`;
                    
                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", d);
                    path.setAttribute("fill", segment.color.startsWith('var') ? `var(--${segment.color.split('--')[1].slice(0, -1)})` : segment.color);
                    path.setAttribute("stroke", "rgba(0,0,0,0.4)");
                    path.setAttribute("stroke-width", "0.5");
                    path.id = `wheel-segment-${i}`;
                    wheel.appendChild(path);

                    const textAngle = startAngle + (360 / numSegments) / 2;
                    let textRadiusMultiplier = 0.7;
                    if (segment.label.length > 10) textRadiusMultiplier = 0.65;
                    const textPos = polarToCartesian(50, 50, 50 * textRadiusMultiplier, textAngle);
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", textPos.x);
                    text.setAttribute("y", textPos.y);
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("dominant-baseline", "middle");
                    text.setAttribute("font-family", "Montserrat, sans-serif");
                    text.setAttribute("font-weight", "700");
                    text.setAttribute("font-size", "4.5px");
                    text.setAttribute("fill", (typeof segment.value === 'string' || segment.isBonus) ? 'white' : 'black');
                    text.setAttribute("transform", `rotate(${textAngle + 90} ${textPos.x} ${textPos.y})`);
                    
                    const words = segment.label.split(' ');
                    if (words.length > 1) {
                         words.forEach((word, index) => {
                            const tspan = document.createElementNS("http://www.w3.org/2000/svg", "tspan");
                            tspan.setAttribute("x", textPos.x);
                            tspan.setAttribute("dy", `${index === 0 ? -0.5 * (words.length - 1) * 4.8 : 4.8}px`);
                            tspan.textContent = word;
                            text.appendChild(tspan);
                        });
                    } else {
                        text.textContent = segment.label;
                    }
                    wheel.appendChild(text);
                }
            }
            
            function updateUI() {
                if (!gameState) return;
                scoreDisplay.textContent = `${gameState.playerScore.toLocaleString('hu-HU')} Ft`;
                hourlyWinningsDisplay.textContent = `${gameState.hourlyWinnings.toLocaleString('hu-HU')} Ft`;
                
                let roundWinningsText = `${gameState.roundWinnings.toLocaleString('hu-HU')} Ft`;
                if(isSunday && gameState.currentBet > 0){
                    roundWinningsText = `${gameState.roundWinnings.toLocaleString('hu-HU')} / -${gameState.currentBet.toLocaleString('hu-HU')} Ft`;
                }
                roundWinningsDisplay.textContent = roundWinningsText;

                if(gameState.totalRounds > 0 && gameState.gameInProgress){
                    roundInfoContainer.style.display = 'flex';
                    roundDisplay.textContent = `Fordul√≥: ${gameState.currentRound}/${gameState.totalRounds}`;
                    const date = new Date(gameState.puzzleHourId * 60 * 60 * 1000);
                    hourBlockDisplay.textContent = `Ad√°s: ${date.getHours()}:00`;
                } else {
                    roundInfoContainer.style.display = 'none';
                }

                wonPrizeContainer.style.display = gameState.wonPrizes.length > 0 ? 'flex' : 'none';
                if (gameState.wonPrizes.length > 0) {
                    wonPrizeName.textContent = gameState.wonPrizes.join(', ');
                }
                
                freeVowelIndicator.style.display = gameState.hasFreeVowel ? 'block' : 'none';
                
                const buttonsToDisable = (!gameState.gameInProgress || gameState.isSpinning || gameState.awaitingConsonant || gameState.isDoubleOrNothingTurn || gameState.inMainPrizeSelection);

                wheelCenterButton.disabled = buttonsToDisable || gameState.noMoreConsonants || gameState.isPoweringUp;
                if(gameState.isPoweringUp) wheelCenterButton.disabled = false;
                
                [solveButton, solveButtonDesktop].forEach(btn => btn.disabled = buttonsToDisable);
                [nyero21Button, nyero21ButtonDesktop].forEach(btn => btn.disabled = !gameState.gameInProgress || isSunday || gameState.inMainPrizeSelection);
                [transferButton, transferButtonDesktop].forEach(btn => btn.disabled = buttonsToDisable || gameState.transferUsedThisHour || isSunday || gameState.playerScore <= 0);
                [lottoButton, lottoButtonDesktop].forEach(btn => btn.disabled = !gameState.gameInProgress || gameState.inMainPrizeSelection);

                lottoBajnokIcon.style.display = isPrizeActive('lotto_bajnok') ? 'block' : 'none';
                
                updateAlphabetPanel();
                updateMainPrizeProgress();
                updateLottoPrizeHud();
                updatePrizeChestHud();
            }
            
            function updateLottoPrizeHud() {
                const prizes = getActiveBonuses();
                if (prizes.length > 0) {
                    lottoPrizeHud.style.display = 'flex';
                    lottoPrizeCount.textContent = prizes.length;
                } else {
                    lottoPrizeHud.style.display = 'none';
                }
            }
            
            function updatePrizeChestHud() {
                const inventory = getPrizeInventory();
                if(inventory.length > 0) {
                    prizeChestHud.style.display = 'flex';
                    prizeChestCount.textContent = inventory.length;
                } else {
                    prizeChestHud.style.display = 'none';
                }
            }

            function updateMainPrizeProgress() {
                if (!gameState || isSunday || !gameState.gameInProgress || gameState.currentRound > gameState.totalRounds || gameState.inMainPrizeSelection) {
                    mainPrizeProgress.style.display = 'none';
                    return;
                }

                mainPrizeProgress.style.display = 'block';
                if (gameState.hourlyWinnings >= MAIN_PRIZE_THRESHOLD) {
                    mainPrizeProgress.innerHTML = `üèÜ <strong>Jogosult vagy a F≈ëd√≠j J√°t√©kra!</strong>`;
                    if (!gameState.mainPrizeQualifiedNotified) {
                        updateHostMessage(getRandomMessage('main_prize_qualified', { threshold: MAIN_PRIZE_THRESHOLD.toLocaleString('hu-HU') }), true);
                        gameState.mainPrizeQualifiedNotified = true;
                    }
                } else {
                    const needed = MAIN_PRIZE_THRESHOLD - gameState.hourlyWinnings;
                    mainPrizeProgress.innerHTML = `A F≈ëd√≠j J√°t√©khoz hi√°nyzik m√©g: <strong>${needed.toLocaleString('hu-HU')} Ft</strong>`;
                }
            }
            
            function showModal({title, text, showInput = false, inputType='text', confirmText = 'Rendben', cancelText = 'M√©gse', showCancel = true}) {
                return new Promise((resolve, reject) => {
                    modalTitle.textContent = title;
                    modalText.innerHTML = text;
                    solveInput.type = inputType;
                    solveInput.style.display = showInput ? 'block' : 'none';
                    if(showInput) {
                      solveInput.value = '';
                      setTimeout(() => solveInput.focus(), 100);
                    }
                    
                    modalButtons.innerHTML = ''; 

                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'modal-btn confirm';
                    confirmBtn.textContent = confirmText;
                    confirmBtn.onclick = () => {
                        closeModal(solveInput.style.display !== 'none' ? solveInput.value : true);
                    };
                    modalButtons.appendChild(confirmBtn);

                    if (showCancel) {
                        const cancelBtn = document.createElement('button');
                        cancelBtn.className = 'modal-btn cancel';
                        cancelBtn.textContent = cancelText;
                        cancelBtn.onclick = () => closeModal(false);
                        modalButtons.appendChild(cancelBtn);
                    }
                    
                    modalOverlay.classList.add('visible');
                    currentModal = { resolve, reject };
                });
            }

            function closeModal(value) {
                modalOverlay.classList.remove('visible');
                if (value !== false && currentModal.resolve) {
                    currentModal.resolve(value);
                } else if (value === false && currentModal.reject) {
                    currentModal.reject();
                }
                currentModal = { resolve: null, reject: null };
            }
            
            function spinWheel(power) {
                if (gameState.isSpinning) return;
                gameState.isSpinning = true;
                gameState.currentSpinValue = null;
                updateUI();
                updateHostMessage(getRandomMessage('spinning'));

                const baseRotations = 3;
                const powerRotation = power * 4;
                const randomExtraRotation = Math.random();
                const totalRotation = (baseRotations + powerRotation + randomExtraRotation) * 360;
                const currentRotation = parseFloat(wheel.dataset.rotation || 0);
                const newRotation = currentRotation + totalRotation;
                wheel.style.transform = `rotate(${newRotation}deg)`;
                wheel.dataset.rotation = newRotation;
                
                setTimeout(() => {
                    try {
                        gameState.isSpinning = false;
                        const segments = getSegmentsForRound(gameState.currentRound);
                        const numSegments = segments.length;
                        const segmentAngle = 360 / numSegments;
                        
                        const finalAngle = newRotation % 360;
                        const pointerAngle = (360 - finalAngle) % 360; 
                        const segmentIndex = Math.floor(pointerAngle / segmentAngle);
                        
                        const result = segments[segmentIndex];
                        
                        const segmentPath = document.getElementById(`wheel-segment-${segmentIndex}`);
                        if (segmentPath) {
                            segmentPath.classList.add('flashing-segment');
                            setTimeout(() => segmentPath.classList.remove('flashing-segment'), 900);
                        }
                        
                        setTimeout(() => handleSpinResult(result), 500);
                        
                        boosterBar.style.transition = 'stroke-dashoffset 0.5s ease-out';
                        boosterBar.style.strokeDashoffset = circumference;
                        setTimeout(()=> { boosterBar.style.transition = 'none' }, 500);
                    } catch (error) {
                        console.error("Hiba a p√∂rget√©s feldolgoz√°sa k√∂zben:", error);
                        updateHostMessage("Hopp√°, egy technikai hiba t√∂rt√©nt! A 'Hiba √Åtugr√°sa' gombbal folytathatod.", true);
                        skipErrorBtn.style.display = 'block';
                    }
                }, 5000);
            }
            
            async function solvePuzzle(autoSolve = false) {
                const puzzleData = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                let attempt = '';
                const normalizeText = (text) => text.toUpperCase().replace(/[^A-Z√Å√â√ç√ì√ñ≈êU√ö√ú≈∞0-9]/g, '');

                const cleanPuzzle = normalizeText(puzzleData.puzzle);

                if (!autoSolve) {
                    try {
                        attempt = await showModal({
                            title: 'Megfejt√©s', text: 'Na, mi a megfejt√©s?', showInput: true, inputType: 'text', confirmText: 'Bek√ºld√∂m!'
                        });
                        if (attempt === false) return;
                    } catch { return; }
                } else {
                    attempt = puzzleData.puzzle;
                }
                const cleanAttempt = normalizeText(attempt);
                const isGoldenRound = isPrizeActive('lotto_bajnok');

                if (cleanAttempt === cleanPuzzle) {
                    if(!autoSolve) {
                        const unrevealedTiles = document.querySelectorAll('.puzzle-tile[data-letter]:not(.revealed)');
                        for (const tile of unrevealedTiles) {
                            tile.classList.add('revealed');
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    }
                    
                    let solveBonus = SOLVE_BONUSES[Math.min(gameState.currentRound - 1, SOLVE_BONUSES.length - 1)];
                    if (gameState.isSolveBonusDoubled) solveBonus *= 2;
                    let roundWinnings = gameState.roundWinnings;
                    
                    if(isGoldenRound) {
                        solveBonus *= 2;
                        roundWinnings *= 2;
                    }

                    let totalGained = roundWinnings + solveBonus;
                    
                    if(isSunday){
                        gameState.playerScore += totalGained + gameState.currentBet; 
                        updateHostMessage(getRandomMessage('solve_sunday_success', {
                            bet: gameState.currentBet.toLocaleString('hu-HU'),
                            totalGained: totalGained.toLocaleString('hu-HU')
                        }), true);
                    } else {
                        gameState.hourlyWinnings += totalGained;
                        gameState.playerScore += totalGained;
                        updateHostMessage(getRandomMessage(isGoldenRound ? 'solve_golden_success' : 'solve_success', {totalGained: totalGained.toLocaleString('hu-HU')}));
                    }
                    saveWeeklyScore(gameState.playerScore);
                    
                    gameState.currentRound++;
                    if (gameState.currentRound <= gameState.totalRounds) {
                        setTimeout(() => startNewRound(), 5000); 
                    } else {
                        gameState.gameInProgress = false;
                        setTimeout(handleEndOfHour, 5000);
                    }
                } else {
                    if(gameState.hasFreeSolveAttempt) {
                        updateHostMessage("Sajnos nem ez a megfejt√©s, de mivel ingyen k√≠s√©rleted volt, nem vesztett√©l semmit!", true);
                        gameState.hasFreeSolveAttempt = false;
                        return;
                    }
                    const penalty = Math.max(500, Math.floor(gameState.roundWinnings * 0.20));
                    gameState.roundWinnings = Math.max(0, gameState.roundWinnings - penalty);
                    updateHostMessage(getRandomMessage('solve_fail', {penalty: penalty.toLocaleString('hu-HU')}), true);
                    updateUI();
                }
            }

            async function startMainPrizeGame(isDevTest = false) {
                 gameState.isDevMainPrizeTest = isDevTest;
                 const mainPrizePuzzles = allPuzzles.filter(p => p.category === 'F≈ëd√≠j Feladv√°ny');
                 if (mainPrizePuzzles.length === 0) {
                     alert("Hiba: Nincs F≈ëd√≠j Feladv√°ny a rendszerben!");
                     if(!isDevTest) gameOver();
                     return;
                 }
                 if (!gameState.puzzleHourId) {
                     gameState.puzzleHourId = Math.floor(Date.now() / (1000 * 60 * 60));
                 }
                 const mainPrizePuzzle = mainPrizePuzzles[gameState.puzzleHourId % mainPrizePuzzles.length];
                 
                 if (isDevTest) {
                     gameState.mainPrizeStake = MAIN_PRIZE_THRESHOLD;
                     mainPrizeModal.querySelector('.dev-mode-indicator').style.display = 'block';
                 } else {
                     gameState.mainPrizeStake = gameState.hourlyWinnings;
                     mainPrizeModal.querySelector('.dev-mode-indicator').style.display = 'none';
                 }

                 gameState.inMainPrizeSelection = true;
                 gameState.guessedLetters = [];
                 gameState.mainPrizeConsonants = [];
                 gameState.mainPrizeVowels = [];
                 
                 mainPrizeModal.style.display = 'flex';
                 createAlphabetPanel(mainPrizeAlphabetContainer);
                 
                 mainPrizeTitle.textContent = "F≈ëd√≠j - Bet≈±v√°laszt√°s";
                 mainPrizeCategory.textContent = "V√°lassz 5 m√°ssalhangz√≥t √©s 1 mag√°nhangz√≥t";
                 mainPrizeInstructions.innerHTML = "√çrd be a megfejt√©st, miel≈ëtt lej√°r az id≈ë!";
                 mainPrizeInstructions.style.display = 'none';
                 mainPrizeSolveInput.style.display = 'none';
                 mainPrizeConfirmBtn.style.display = 'none';
                 mainPrizeCloseBtn.style.display = 'none';
                 mainPrizeFinalAnswer.style.display = 'none';
                 mainPrizeSelectConfirmBtn.style.display = 'inline-flex';
                 mainPrizeSelectConfirmBtn.disabled = true;
                 mainPrizeTimer.style.display = 'none';
                 mainPrizeBoard.innerHTML = '';
                 setupPuzzleBoard(mainPrizeBoard, mainPrizePuzzle);
                 mainPrizeGivenLetters.innerHTML = '';
                 updateUI();
            }

            function handleMainPrizeLetterSelection(letter) {
                if (!gameState.inMainPrizeSelection || gameState.guessedLetters.includes(letter)) return;
                
                const isVowel = VOWELS.includes(letter);
                
                if (isVowel && gameState.mainPrizeVowels.length < 1) {
                    gameState.mainPrizeVowels.push(letter);
                    gameState.guessedLetters.push(letter);
                } else if (!isVowel && gameState.mainPrizeConsonants.length < 5) {
                    gameState.mainPrizeConsonants.push(letter);
                    gameState.guessedLetters.push(letter);
                }

                updateAlphabetPanel();

                const consonantsLeft = 5 - gameState.mainPrizeConsonants.length;
                const vowelsLeft = 1 - gameState.mainPrizeVowels.length;
                mainPrizeCategory.textContent = `V√°lassz m√©g: ${consonantsLeft} m√°ssalhangz√≥t, ${vowelsLeft} mag√°nhangz√≥t`;
                
                if (consonantsLeft === 0 && vowelsLeft === 0) {
                     mainPrizeCategory.textContent = 'Minden bet≈± kiv√°lasztva! K√©szen √°llsz?';
                     mainPrizeSelectConfirmBtn.disabled = false;
                }
            }

            function runMainPrizeCountdown() {
                 mainPrizeSelectConfirmBtn.style.display = 'none';
                 mainPrizeTitle.textContent = "F≈ëd√≠j J√°t√©k";
                 const mainPrizePuzzles = allPuzzles.filter(p => p.category === 'F≈ëd√≠j Feladv√°ny');
                 const mainPrizePuzzle = mainPrizePuzzles[gameState.puzzleHourId % mainPrizePuzzles.length];
                 mainPrizeCategory.textContent = mainPrizePuzzle.category;
                 mainPrizeAlphabetContainer.style.display = 'none';

                 mainPrizeInstructions.style.display = 'block';
                 mainPrizeSolveInput.style.display = 'block';
                 mainPrizeSolveInput.value = '';
                 mainPrizeConfirmBtn.style.display = 'inline-flex';
                 mainPrizeTimer.style.display = 'block';

                 const chosenLetters = [...gameState.mainPrizeConsonants, ...gameState.mainPrizeVowels];
                 mainPrizeGivenLetters.textContent = `A v√°lasztott bet≈±id: ${chosenLetters.join(', ')}`;
                 
                 chosenLetters.forEach(letter => {
                     mainPrizeBoard.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]`).forEach(tile => tile.classList.add('revealed'));
                 });
                     
                 let timeLeft = MAIN_PRIZE_TIME * 10;
                 let hintGiven = false;
                 mainPrizeTimer.textContent = (timeLeft / 10).toFixed(1);
                 mainPrizeTimer.classList.remove('timer-low');
                 mainPrizeSolveInput.disabled = false;
                 mainPrizeConfirmBtn.disabled = false;
                 setTimeout(() => mainPrizeSolveInput.focus(), 100);
                 
                 mainPrizeTimerInterval = setInterval(() => {
                     timeLeft--;
                     mainPrizeTimer.textContent = (timeLeft / 10).toFixed(1);
                     
                     if (!hintGiven && timeLeft <= 150) { // 15 seconds
                        hintGiven = true;
                        if (mainPrizePuzzle.hint) {
                            mainPrizeInstructions.innerHTML = `Seg√≠ts√©g: Ez egy <strong>${mainPrizePuzzle.hint}</strong>`;
                        }
                     }

                     if(timeLeft <= 100 && !mainPrizeTimer.classList.contains('timer-low')) {
                        mainPrizeTimer.classList.add('timer-low');
                     }
                     if(timeLeft <= 0) {
                        endMainPrizeGame(false, true);
                     }
                 }, 100);
            }
            
            function endMainPrizeGame(isWin, isTimeout = false) {
                clearInterval(mainPrizeTimerInterval);
                mainPrizeSolveInput.disabled = true;
                mainPrizeConfirmBtn.disabled = true;
                const stake = gameState.mainPrizeStake;
                const isDevTest = gameState.isDevMainPrizeTest;
                
                if (isWin) {
                    const winnings = stake; 
                    if (!isDevTest) {
                       gameState.playerScore += winnings; 
                       gameState.hourlyWinnings += winnings;
                    }
                    const totalDisplay = (stake + winnings).toLocaleString('hu-HU');
                    updateHostMessage(getRandomMessage('main_prize_win', { winnings: totalDisplay }) + (isDevTest ? ' (TESZT)' : ''), true);
                } else {
                    if (!isDevTest) {
                        gameState.playerScore -= stake;
                        gameState.hourlyWinnings = 0;
                    }
                    updateHostMessage(getRandomMessage(isTimeout ? 'main_prize_lose_timeout' : 'main_prize_lose') + (isDevTest ? ' (TESZT)' : ''), true);

                    const mainPrizePuzzles = allPuzzles.filter(p => p.category === 'F≈ëd√≠j Feladv√°ny');
                    const mainPrizePuzzle = mainPrizePuzzles[gameState.puzzleHourId % mainPrizePuzzles.length];
                    mainPrizeFinalAnswer.textContent = `A helyes megfejt√©s: ${mainPrizePuzzle.puzzle}`;
                    mainPrizeFinalAnswer.style.display = 'block';
                }
                
                mainPrizeCloseBtn.style.display = 'inline-flex';
                
                if (!isDevTest) {
                    gameState.hourlyWinnings = 0;
                    saveWeeklyScore(gameState.playerScore);
                }
                gameState.mainPrizeStake = 0;
            }

            function forceEndMainPrize() {
                mainPrizeModal.style.display = 'none';
                gameState.inMainPrizeSelection = false;
                document.getElementById('puzzle-section').insertBefore(alphabetPanel, document.getElementById('desktop-action-buttons'));
                createAlphabetPanel();
                if (!gameState.isDevMainPrizeTest) {
                     gameOver();
                } else {
                    gameState.isDevMainPrizeTest = false;
                }
            }

            function launchNyero21(isDevTest = false) {
                isDevModeActive = isDevTest;
                let playsLeft = MINIGAME_PLAYS_PER_HOUR;
                const currentScore = gameState ? gameState.playerScore : loadWeeklyScore();

                if (!isDevModeActive) {
                    if (!gameState || !gameState.gameInProgress) return;
                    const currentHourId = Math.floor(Date.now() / (1000 * 60 * 60));
                    const lastPlayedHour = localStorage.getItem('nyero21HourId');

                    if (currentHourId.toString() !== lastPlayedHour) {
                        gameState.nyero21PlaysThisHour = 0;
                        localStorage.setItem('nyero21HourId', currentHourId.toString());
                        localStorage.setItem('nyero21Plays', '0');
                    } else {
                        gameState.nyero21PlaysThisHour = parseInt(localStorage.getItem('nyero21Plays') || '0', 10);
                    }
                    playsLeft = MINIGAME_PLAYS_PER_HOUR - gameState.nyero21PlaysThisHour;

                    if (playsLeft <= 0) {
                        alert("Ebben az √≥r√°ban m√°r nem j√°tszhatod a Nyer≈ë21-et. Gyere vissza k√©s≈ëbb!");
                        return;
                    }
                }

                nyero21StakingArea.style.display = 'block';
                nyero21GameArea.style.display = 'none';
                nyero21PlayerBalance.textContent = currentScore.toLocaleString('hu-HU');
                nyero21PlaysLeft.textContent = isDevModeActive ? "TESZT M√ìD: Korl√°tlan j√°t√©k." : `Ebben az √≥r√°ban m√©g ${playsLeft} alkalommal j√°tszhatsz.`;
                nyero21StakeInput.value = '';
                nyero21Modal.querySelector('.dev-mode-indicator').style.display = isDevModeActive ? 'block' : 'none';
                nyero21Modal.classList.add('visible');
            }

            function startNyero21() {
                const stake = isDevModeActive ? 10000 : parseInt(nyero21StakeInput.value, 10);
                const currentScore = gameState ? gameState.playerScore : loadWeeklyScore();

                if (!isDevModeActive) {
                    if (isNaN(stake) || stake <= 0) {
                        alert("K√©rlek, adj meg egy √©rv√©nyes, pozit√≠v t√©tet!");
                        return;
                    }
                    if (stake > currentScore) {
                        alert("Nincs el√©g zsetonod ehhez a t√©thez!");
                        return;
                    }
                }

                nyero21State = {
                    stake: stake,
                    deck: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11].sort(() => 0.5 - Math.random()),
                    playerSum: 0,
                    cardsDrawn: 0,
                    gameOver: false
                };
                
                const winPrize = stake * 2;
                const jackpotPrize = stake * 5;
                const balanceAfterStake = isDevModeActive ? currentScore : currentScore - stake;
                nyero21InfoBar.innerHTML = `
                    Feltett t√©t: <strong>${stake.toLocaleString('hu-HU')} Ft</strong><br>
                    Jelenlegi egyenleg: <strong>${balanceAfterStake.toLocaleString('hu-HU')} Ft</strong><br>
                    V√°rhat√≥ nyerem√©ny (18-20): <strong>${winPrize.toLocaleString('hu-HU')} Ft</strong><br>
                    V√°rhat√≥ nyerem√©ny (21): <strong>${jackpotPrize.toLocaleString('hu-HU')} Ft</strong>
                `;

                if (!isDevModeActive) {
                    gameState.playerScore -= stake;
                    saveWeeklyScore(gameState.playerScore);
                    updateUI();
                }

                nyero21StakingArea.style.display = 'none';
                nyero21GameArea.style.display = 'block';
                nyero21PlayerScore.textContent = '0';
                nyero21ResultMessage.textContent = '';
                nyero21ResultMessage.className = 'nyero21-result-message';
                nyero21HitBtn.style.display = 'inline-flex';
                nyero21StandBtn.style.display = 'inline-flex';
                nyero21StandBtn.disabled = true;
                nyero21NewGameBtn.style.display = 'none';
                nyero21CloseBtn.style.display = 'none';

                nyero21CardDeck.innerHTML = '';
                nyero21State.deck.forEach((value) => {
                    const card = document.createElement('div');
                    card.className = 'nyero21-card';
                    card.dataset.value = value;
                    card.innerHTML = `<div class="nyero21-card-face nyero21-card-back"></div><div class="nyero21-card-face nyero21-card-front">${value}</div>`;
                    card.addEventListener('click', () => drawCard(card));
                    nyero21CardDeck.appendChild(card);
                });
            }

            function drawCard(cardElement) {
                if (nyero21State.gameOver || cardElement.classList.contains('flipped')) return;

                cardElement.classList.add('flipped');
                const value = parseInt(cardElement.dataset.value, 10);
                nyero21State.playerSum += value;
                nyero21State.cardsDrawn++;
                
                nyero21PlayerScore.textContent = nyero21State.playerSum;
                if (nyero21State.cardsDrawn >= 2) {
                    nyero21StandBtn.disabled = false;
                }
                
                if (nyero21State.playerSum > 21) {
                    endNyero21('lose', 'CS≈êD! T√∫l sok!');
                } else if (nyero21State.playerSum === 21) {
                     endNyero21('jackpot', 'NYER≈ê21! JACKPOT!');
                }
            }
            
            function standNyero21() {
                if(nyero21State.playerSum >= 18 && nyero21State.playerSum <= 20) {
                    endNyero21('win', 'NYERT√âL!');
                } else {
                    endNyero21('lose', 'T√∫l kev√©s, a h√°z nyert.');
                }
            }

            function endNyero21(result, message) {
                if (nyero21State.gameOver) return;
                nyero21State.gameOver = true;
                nyero21HitBtn.style.display = 'none';
                nyero21StandBtn.style.display = 'none';
                
                let winnings = 0;
                if (result === 'win') {
                    winnings = nyero21State.stake * 2;
                    nyero21ResultMessage.classList.add('win');
                } else if (result === 'jackpot') {
                    winnings = nyero21State.stake * 5;
                    nyero21ResultMessage.classList.add('win');
                } else {
                    nyero21ResultMessage.classList.add('lose');
                }
                
                nyero21ResultMessage.textContent = message;
                if(winnings > 0) {
                     nyero21ResultMessage.textContent += ` Nyerem√©ny: ${winnings.toLocaleString('hu-HU')} Ft`;
                }

                if (!isDevModeActive) {
                    gameState.playerScore += winnings;
                    saveWeeklyScore(gameState.playerScore);
                    updateUI();
                    gameState.nyero21PlaysThisHour++;
                    localStorage.setItem('nyero21Plays', gameState.nyero21PlaysThisHour.toString());
                } else {
                    nyero21ResultMessage.textContent += " (Teszt Nyerem√©ny)";
                }

                const playsLeft = MINIGAME_PLAYS_PER_HOUR - (gameState ? gameState.nyero21PlaysThisHour : 0);
                
                if (isDevModeActive || playsLeft > 0) {
                    nyero21NewGameBtn.style.display = 'inline-flex';
                }
                nyero21CloseBtn.style.display = 'inline-flex';

                const unflippedCards = document.querySelectorAll('.nyero21-card:not(.flipped)');
                unflippedCards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('flipped');
                    }, 200 * (index + 1));
                });
            }

            function togglePowerMeter() {
                if (wheelCenterButton.disabled && !gameState.isPoweringUp) return;
                
                if (!gameState.isPoweringUp) {
                    gameState.isPoweringUp = true;
                    wheelCenterText.textContent = "Stop";
                    updateHostMessage(getRandomMessage('power_up'));
                    
                    cancelAnimationFrame(powerAnimationId);
                    let startTime = null;
                    
                    const animatePower = (timestamp) => {
                        if (!startTime) startTime = timestamp;
                        const elapsed = timestamp - startTime;
                        const power = (Math.sin(elapsed / 600) + 1) / 2;
                        gameState.currentPower = power;
                        
                        const offset = circumference * (1 - power);
                        boosterBar.style.strokeDashoffset = offset;
                        
                        powerAnimationId = requestAnimationFrame(animatePower);
                    };
                    requestAnimationFrame(animatePower);
                    
                } else {
                    gameState.isPoweringUp = false;
                    cancelAnimationFrame(powerAnimationId);
                    wheelCenterText.textContent = "P√∂rget";
                    spinWheel(gameState.currentPower);
                }
            }
             function checkAllConsonantsGuessed() {
                const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]].puzzle.toUpperCase();
                const uniqueChars = [...new Set(currentPuzzle.split(''))];
                const consonantsInPuzzle = uniqueChars.filter(char => !VOWELS.includes(char) && FULL_ALPHABET.includes(char));

                const allGuessed = consonantsInPuzzle.every(consonant => gameState.guessedLetters.includes(consonant));

                if (allGuessed && !gameState.noMoreConsonants) {
                    gameState.noMoreConsonants = true;
                    updateHostMessage(getRandomMessage('no_more_consonants'), true);
                    updateUI();
                }
             }
            
            async function handleSpinResult(result) {
                gameState.awaitingConsonant = false;
                
                if (result.isBonus) {
                    updateHostMessage(getRandomMessage('bonus_points', {value: result.value.toLocaleString('hu-HU')}), true);
                    gameState.roundWinnings += result.value;
                    endTurn();
                    return;
                }

                switch(result.value) {
                    case 'bankrupt':
                        if (gameState.hasBankruptProtection) {
                            updateHostMessage("CS≈êD! De a meglepet√©sk√©nt kapott v√©delmed megmentett! Nem vesztett√©l semmit.", true);
                            gameState.hasBankruptProtection = false;
                        } else if (isPrizeActive('one_hit_wonder') || isPrizeActive('four_hit_no_bankrupt')) {
                           updateHostMessage("CS≈êD! De a Lott√≥n nyert v√©delmed megmentett! Nem vesztett√©l semmit.", true);
                        } else if(isSunday){
                             updateHostMessage(getRandomMessage('bankrupt_sunday', {bet: gameState.currentBet.toLocaleString('hu-HU')}), true);
                             gameState.playerScore -= gameState.currentBet;
                             gameState.playerScore = Math.max(0, gameState.playerScore);
                             saveWeeklyScore(gameState.playerScore);
                             gameState.roundWinnings = 0;
                        } else {
                             updateHostMessage(getRandomMessage('bankrupt'), true);
                             gameState.roundWinnings = 0;
                        }
                        endTurn();
                        break;
                    case 'lose_turn':
                        updateHostMessage(getRandomMessage('lose_turn'), true);
                        endTurn();
                        break;
                    case 'double_or_nothing':
                        handleDoubleOrNothing();
                        break;
                    case 'special_prize':
                        await handleSpecialPrize();
                        break;
                    case 'free_vowel':
                        gameState.hasFreeVowel = true;
                        updateHostMessage(getRandomMessage('free_vowel_spin'), true);
                        endTurn();
                        break;
                    case 'assistance':
                        await handleAssistance();
                        break;
                    case 'halver':
                        const amountLost = gameState.roundWinnings - Math.floor(gameState.roundWinnings / 2);
                        gameState.halverAmountLostThisRound += amountLost;
                        updateHostMessage(getRandomMessage('halver_spin'), true);
                        gameState.roundWinnings = Math.floor(gameState.roundWinnings / 2);
                        endTurn();
                        break;
                    case 'surprise':
                        handleSurprise();
                        break;
                    default: 
                        gameState.currentSpinValue = result.value;
                        gameState.awaitingConsonant = true;
                        updateHostMessage(getRandomMessage('spin_result', {value: result.value.toLocaleString('hu-HU')}), true);
                        updateUI();
                        break;
                }
            }

            function handleSurprise() {
                const surprise = SURPRISE_EVENTS[Math.floor(Math.random() * SURPRISE_EVENTS.length)];
                updateHostMessage(surprise.text, true);
                if (surprise.execute) {
                    surprise.execute(gameState);
                } else {
                    endTurn();
                }
            }
            
            function showAutoHint() {
                const puzzleData = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                if (!puzzleData.hints || puzzleData.hints.length === 0) return;

                let hintsToShow = [];
                let newHintAppeared = false;
                
                const currentHints = autoHintsContainer.innerHTML;

                if (gameState.consecutiveWrongConsonants >= 5 && puzzleData.hints[0] && !currentHints.includes(puzzleData.hints[0])) {
                    hintsToShow.push(`<strong>1. Seg√≠ts√©g:</strong> ${puzzleData.hints[0]}`);
                    newHintAppeared = true;
                }
                if (gameState.consecutiveWrongConsonants >= 10 && puzzleData.hints[1] && !currentHints.includes(puzzleData.hints[1])) {
                    hintsToShow.push(`<strong>2. Seg√≠ts√©g:</strong> ${puzzleData.hints[1]}`);
                    newHintAppeared = true;
                }

                if (newHintAppeared) {
                    const newContent = hintsToShow.join('<br><br>');
                    autoHintsContainer.innerHTML = currentHints ? `${currentHints}<br><br>${newContent}` : newContent;
                    autoHintsContainer.style.display = 'block';
                    autoHintsContainer.classList.add('hint-appearing');
                    setTimeout(() => autoHintsContainer.classList.remove('hint-appearing'), 1500);
                }
            }

            async function handleAssistance() {
                 if (isPrizeActive('lotto_bajnok')) {
                    updateHostMessage("Lott√≥Bajnokk√©nt a seg√≠ts√©g ingyenes!", true);
                 }
                const puzzleStr = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]].puzzle.toUpperCase();
                const freq = {};
                for (const char of puzzleStr) {
                    if (!VOWELS.includes(char) && FULL_ALPHABET.includes(char) && !gameState.guessedLetters.includes(char)) {
                        freq[char] = (freq[char] || 0) + 1;
                    }
                }
                
                const mostFrequentChar = Object.keys(freq).sort((a,b) => freq[b] - freq[a])[0];

                if (mostFrequentChar) {
                    updateHostMessage(getRandomMessage('assistance_spin', {letter: mostFrequentChar}), true);
                    const foundCount = (puzzleStr.match(new RegExp(mostFrequentChar, "g")) || []).length;
                    gameState.guessedLetters.push(mostFrequentChar);
                    await revealAndCalculate(mostFrequentChar, false, foundCount, true); 
                } else {
                    updateHostMessage("Seg√≠ts√©g! De m√°r minden m√°ssalhangz√≥t kital√°lt√°l. Sebaj!", true);
                    endTurn();
                }
            }

            async function handleSpecialPrize() {
                const availablePrizes = SPECIAL_PRIZES.filter(p => !gameState.wonPrizes.includes(p.name));
                
                if (availablePrizes.length === 0) {
                    const cashAward = 50000;
                    gameState.roundWinnings += cashAward;
                    updateHostMessage(`M√°r az √∂sszes k√ºl√∂nd√≠jat bezsebelted! Gratul√°lunk! Jutalmad helyette <strong>${cashAward.toLocaleString('hu-HU')} Ft</strong>!`, true);
                    gameState.specialPrizeWon = true;
                    endTurn();
                    return;
                }
                
                const prize = availablePrizes[Math.floor(Math.random() * availablePrizes.length)];
                const cashValue = Math.floor(prize.value / 2);
                
                try {
                    const choice = await showModal({
                        title: 'K√ºl√∂nd√≠j!',
                        text: `Gratul√°lok, nyert√©l egy K√ºl√∂nd√≠jat: <strong>${prize.name}</strong>!<br><br>V√°laszthatsz: k√©red a t√°rgyat, vagy ink√°bb j√∂jj√∂n az √©rt√©k√©nek fele, <strong>${cashValue.toLocaleString('hu-HU')}&nbsp;Ft</strong>?`,
                        confirmText: 'K√©rem a cuccot!',
                        cancelText: `J√∂het a zseton (${cashValue.toLocaleString('hu-HU')} Ft)`,
                    });

                    if (choice) {
                        gameState.wonPrizes.push(prize.name);
                        updateHostMessage(`Remek v√°laszt√°s! A(z) <strong>${prize.name}</strong> m√°r a ti√©d!`, true);
                    } else {
                         gameState.roundWinnings += cashValue;
                         updateHostMessage(`Okos d√∂nt√©s! <strong>${cashValue.toLocaleString('hu-HU')}&nbsp;Ft</strong> j√≥v√°√≠rva!`, true);
                    }
                } catch { 
                     gameState.roundWinnings += cashValue;
                     updateHostMessage(`A biztos p√©nzt v√°lasztottad, <strong>${cashValue.toLocaleString('hu-HU')}&nbsp;Ft</strong> j√≥v√°√≠rva!`, true);
                }
                
                gameState.specialPrizeWon = true;
                endTurn();
            }
            
            async function handleTransfer() {
                if (gameState.transferUsedThisHour) {
                    alert("Ebben az √≥r√°ban m√°r haszn√°ltad az √°tutal√°st!");
                    return;
                }
                if (gameState.playerScore <= 0) {
                    alert("Nincs el√©g zsetonod az √°tutal√°shoz!");
                    return;
                }

                try {
                    const amountStr = await showModal({
                        title: 'Zseton √Åtutal√°s',
                        text: `Mennyi zsetont szeretn√©l √°tutalni az <strong>√ñsszes Zsetonodb√≥l</strong> (${gameState.playerScore.toLocaleString('hu-HU')} Ft) az <strong>Ebben a k√∂rben</strong> l√©v≈ë √∂sszeghez?<br><br>Maximum 10.000 Ft utalhat√≥. Az utal√°s d√≠ja az √∂sszeg 10%-a.`,
                        showInput: true,
                        inputType: 'number',
                        confirmText: 'Tov√°bb',
                        cancelText: 'M√©gse'
                    });

                    const amount = parseInt(amountStr, 10);

                    if (isNaN(amount) || amount <= 0) {
                        if (amountStr !== false) alert("√ârv√©nytelen √∂sszeg.");
                        return;
                    }
                    if (amount > 10000) {
                        alert("Maximum 10.000 Ft-ot utalhatsz √°t.");
                        return;
                    }
                    
                    const fee = Math.ceil(amount * 0.1);
                    const totalCost = amount + fee;

                    if (totalCost > gameState.playerScore) {
                        alert(`Nincs el√©g zsetonod a ${amount.toLocaleString('hu-HU')} Ft-os utal√°sra √©s annak ${fee.toLocaleString('hu-HU')} Ft-os d√≠j√°ra (√∂sszesen ${totalCost.toLocaleString('hu-HU')} Ft).`);
                        return;
                    }
                    
                    const confirmTransfer = await showModal({
                        title: '√Åtutal√°s Meger≈ës√≠t√©se',
                        text: `√Åtutalsz <strong>${amount.toLocaleString('hu-HU')} Ft</strong>-ot. <br>A tranzakci√≥ d√≠ja: <strong>${fee.toLocaleString('hu-HU')} Ft</strong>.<br>Teljes k√∂lts√©g: <strong>${totalCost.toLocaleString('hu-HU')} Ft</strong>.<br><br>Biztosan folytatod?`,
                        confirmText: 'Igen, utal√°s!',
                        cancelText: 'Nem'
                    });

                    if (confirmTransfer) {
                        gameState.playerScore -= totalCost;
                        gameState.roundWinnings += amount;
                        gameState.transferUsedThisHour = true;
                        localStorage.setItem(`pordgesdFelTransfer_${gameState.puzzleHourId}`, 'true');

                        updateHostMessage(`Sikeres √°tutal√°s! <strong>${amount.toLocaleString('hu-HU')} Ft</strong> hozz√°adva a k√∂r√∂s p√©nzedhez.`, true);
                        saveWeeklyScore(gameState.playerScore);
                        updateUI();
                    }

                } catch (err) {
                    updateHostMessage("Az √°tutal√°s megszak√≠tva.");
                    updateUI();
                }
            }

            function handleDoubleOrNothing() {
                if (gameState.roundWinnings <= 0) {
                    updateHostMessage("DUPLA VAGY SEMMI, de nincs mit kock√°ztatni. P√∂rgess tov√°bb!", true);
                    endTurn();
                    return;
                }
                gameState.isDoubleOrNothingTurn = true;
                updateHostMessage(getRandomMessage('double_or_nothing_prompt', { points: gameState.roundWinnings.toLocaleString('hu-HU') }), true);
                updateUI();
            }

            function handleLetterGuess(letter) {
                if (gameState.inMainPrizeSelection) {
                    handleMainPrizeLetterSelection(letter);
                    return;
                }

                if (document.querySelector(`#alphabet-panel .alphabet-key[data-letter="${letter}"]`).disabled) return;
                
                const isVowel = VOWELS.includes(letter);
                
                if (gameState.isDoubleOrNothingTurn) {
                    if (isVowel) return; 
                    handleDoubleOrNothingGuess(letter);
                    return;
                }

                if (!isVowel && !gameState.awaitingConsonant) return;
                if (isVowel && gameState.awaitingConsonant) return;

                if (isVowel) {
                    if (gameState.vowelsPurchasedThisRound >= 10) {
                        alert("Ebben a feladv√°nyban m√°r nem vehetsz t√∂bb mag√°nhangz√≥t!");
                        return;
                    }
                    const cost = getCurrentVowelCost();
                    if (gameState.hasFreeVowel) {
                        gameState.hasFreeVowel = false;
                        updateHostMessage("Felhaszn√°ltad az ingyen p√∂rgetett mag√°nhangz√≥t!", true);
                    } else {
                        if(gameState.roundWinnings < cost) {
                             alert(`Nincs el√©g p√©nzed a mag√°nhangz√≥ra! (${cost} Ft)`);
                             return;
                        }
                        gameState.roundWinnings -= cost;
                        gameState.vowelsPurchasedThisRound++;
                    }
                }
                
                gameState.guessedLetters.push(letter);
                
                const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]].puzzle.toUpperCase();
                const foundCount = (currentPuzzle.match(new RegExp(letter, "g")) || []).length;

                if (foundCount > 0) {
                    if (!isVowel) gameState.consecutiveWrongConsonants = 0;
                    revealAndCalculate(letter, isVowel, foundCount);
                } else {
                    if (!isVowel) {
                        gameState.consecutiveWrongConsonants++;
                        showAutoHint();
                    }
                    updateHostMessage(getRandomMessage('wrong_letter'));
                    endTurn();
                }
            }

             async function handleDoubleOrNothingGuess(letter) {
                gameState.guessedLetters.push(letter);
                const currentPuzzle = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]].puzzle.toUpperCase();
                const foundCount = (currentPuzzle.match(new RegExp(letter, "g")) || []).length;

                if (foundCount > 0) {
                    gameState.consecutiveWrongConsonants = 0;
                    gameState.roundWinnings *= 2;
                    updateHostMessage(getRandomMessage('double_win', { points: gameState.roundWinnings.toLocaleString('hu-HU') }), true);
                    await revealAndCalculate(letter, false, foundCount, true);
                } else {
                    gameState.consecutiveWrongConsonants++;
                    showAutoHint();
                    gameState.roundWinnings = 0;
                    updateHostMessage(getRandomMessage('double_lose'), true);
                    endTurn();
                }
            }
            async function revealAndCalculate(letter, isVowel, foundCount, skipEarnings = false){
                wheelCenterButton.disabled = true;
                [solveButton, solveButtonDesktop].forEach(btn => btn.disabled = true);

                const tilesToReveal = document.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]:not(.revealed)`);
                
                if (!skipEarnings) {
                    tilesToReveal.forEach(tile => {
                        const frontFace = tile.querySelector('.tile-front');
                        if (frontFace) frontFace.classList.add('flashing');
                    });
                    await new Promise(resolve => setTimeout(resolve, 1200));
                    tilesToReveal.forEach(tile => {
                        const frontFace = tile.querySelector('.tile-front');
                        if (frontFace) frontFace.classList.remove('flashing');
                    });
                }
                
                for (const tile of tilesToReveal) {
                    tile.classList.add('revealed');
                    await new Promise(resolve => setTimeout(resolve, 150));
                }

                if (!skipEarnings) {
                    if (isVowel) {
                        updateHostMessage(getRandomMessage('correct_vowel', {count: foundCount}));
                    } else {
                        let earnings = foundCount * gameState.currentSpinValue;
                        if(isPrizeActive('three_hit_boost')) earnings *= 2;
                        if(gameState.isCategoryBonusActive) {
                            earnings *=2;
                            gameState.isCategoryBonusActive = false;
                        }
                        gameState.roundWinnings += earnings;
                        
                        if (earnings >= HUGE_WIN_THRESHOLD) {
                            updateHostMessage(getRandomMessage('huge_win_consonant', {count: foundCount, earnings: earnings.toLocaleString('hu-HU')}));
                        } else {
                            updateHostMessage(getRandomMessage('correct_consonant', {count: foundCount, earnings: earnings.toLocaleString('hu-HU')}));
                        }
                    }
                }

                if (document.querySelectorAll('.puzzle-tile[data-letter]').length === document.querySelectorAll('.puzzle-tile.revealed').length) {
                    setTimeout(() => solvePuzzle(true), 1000);
                } else {
                    checkAllConsonantsGuessed();
                    endTurn();
                }
            }
            function gameOver(customMessage = '') {
                gameState.gameInProgress = false;
                saveWeeklyScore(gameState.playerScore);

                if (isSunday && gameState.playerScore >= MILLIONAIRE_THRESHOLD) {
                    const currentWeekId = getWeekNumber(new Date());
                    const [year, weekStr] = currentWeekId.split('-W');
                    let week = parseInt(weekStr);
                    let nextWeek = week + 1;
                    let nextYear = parseInt(year);
                    if (nextWeek > 52) { nextWeek = 1; nextYear++; }
                    const nextWeekId = `${nextYear}-W${nextWeek.toString().padStart(2, '0')}`;
                    localStorage.setItem('millionaireUntilWeekId', nextWeekId);
                    updateHostMessage(`Gratul√°lok, <strong>${gameState.playerScore.toLocaleString('hu-HU')}&nbsp;Ft</strong>-tal te lett√©l a <strong>H√©t Milliomosa!</strong>`, true);
                } else {
                    const finalMessage = customMessage || getRandomMessage('game_over', {score: gameState.playerScore.toLocaleString('hu-HU')});
                    updateHostMessage(finalMessage, true);
                }
                 
                localStorage.setItem('lastPlayedHourId', gameState.puzzleHourId.toString());
                newGameButton.style.display = 'block';
                wheelCenterButton.style.display = 'none';
                [solveButton, solveButtonDesktop, nyero21Button, nyero21ButtonDesktop, transferButton, transferButtonDesktop, lottoButton, lottoButtonDesktop].forEach(btn => btn.style.display = 'none');
                updateUI();
            }
            function endTurn() {
                gameState.currentSpinValue = null;
                gameState.awaitingConsonant = false;
                gameState.isDoubleOrNothingTurn = false;
                
                setTimeout(() => {
                    if (gameState.gameInProgress && document.querySelectorAll('.puzzle-tile[data-letter]').length !== document.querySelectorAll('.puzzle-tile.revealed').length) {
                         if (!gameState.noMoreConsonants) {
                           updateHostMessage(getRandomMessage('turn_end'));
                        } else {
                           updateHostMessage(getRandomMessage('no_more_consonants'), true);
                        }
                    }
                    updateUI();
                }, 1500); 
            }
            async function promptForBet() {
                let bet = null;
                while (bet === null) {
                    try {
                        const rawBet = await showModal({
                            title: 'Pr√©mium Vas√°rnap T√©t',
                            text: `A Heti Kassz√°ban: <strong>${gameState.playerScore.toLocaleString('hu-HU')}&nbsp;Ft</strong>. Mennyi a t√©t erre a k√∂rre?`,
                            showInput: true, inputType: 'text',
                            confirmText: 'Mehet a t√©t!', showCancel: false
                        });
                        
                        if (rawBet === '0000') {
                            openDevMenu();
                            return null;
                        }

                        const betAmount = parseInt(rawBet, 10);
                        if (isNaN(betAmount) || betAmount <= 0) {
                            alert("K√©rlek, √©rv√©nyes, null√°n√°l nagyobb sz√°mot adj meg!");
                        } else if (betAmount > gameState.playerScore) {
                            alert("Nincs el√©g p√©nz a kassz√°ban ekkora t√©thez!");
                        } else {
                            bet = betAmount;
                        }
                    } catch {
                         alert("A t√©t megad√°sa k√∂telez≈ë a folytat√°shoz!");
                    }
                }
                return bet;
            }
            
            function startNewRound() {
                gameState.isCategoryBonusActive = false;
                gameState.hasBankruptProtection = false;
                gameState.halverAmountLostThisRound = 0;
                gameState.hasFreeSolveAttempt = false;
                gameState.isSolveBonusDoubled = false;
                gameState.roundWinnings = 0;
                gameState.noMoreConsonants = false;
                gameState.currentBet = 0;
                gameState.guessedLetters = [];
                gameState.consecutiveWrongConsonants = 0;
                gameState.vowelsPurchasedThisRound = 0;
                autoHintsContainer.innerHTML = '';
                autoHintsContainer.style.display = 'none';
                
                setupRound();
            }

            async function setupRound() {
                 if (gameState.currentRound > gameState.totalRounds) {
                     handleEndOfHour();
                     return;
                }
                
                const puzzleData = allPuzzles[hourlyPuzzleIndices[gameState.currentRound - 1]];
                
                if (isPrizeActive('lotto_bajnok')) {
                    puzzleCategory.classList.add('golden');
                    updateHostMessage(getRandomMessage('start_golden_round'), true);
                } else {
                    puzzleCategory.classList.remove('golden');
                }
                
                if(isPrizeActive('two_hit_reveal') && puzzleData.puzzle.replace(/\s/g, '').length > 8) {
                    let consonants = [...new Set(puzzleData.puzzle.split('').filter(c => !VOWELS.includes(c) && c !== ' '))];
                    for(let i = 0; i < 2 && consonants.length > 0; i++) {
                        const randIndex = Math.floor(Math.random() * consonants.length);
                        const letterToReveal = consonants.splice(randIndex, 1)[0];
                        gameState.guessedLetters.push(letterToReveal);
                    }
                }

                if(isSunday){
                    mainPrizeProgress.style.display = 'none';
                    document.getElementById('hourly-hud').style.display = 'none';
                    document.getElementById('round-winnings-hud').style.flexBasis = '100%';

                    const bet = await promptForBet();
                    if (bet === null) return;
                    gameState.currentBet = bet;
                    gameState.playerScore -= bet;
                }
                
                drawWheel(gameState.currentRound);
                
                puzzleCategory.textContent = puzzleData.category;
                
                if (gameState.currentRound === 1 && !isPrizeActive('lotto_bajnok')) {
                     if (!isSunday && localStorage.getItem('quitHourId') == gameState.puzzleHourId) {
                        updateHostMessage(getRandomMessage('quit_warning'), true);
                     } else {
                        updateHostMessage(getRandomMessage(isSunday ? 'sunday_greeting' : 'start_game'));
                     }
                 } else if(!isPrizeActive('lotto_bajnok')) {
                    updateHostMessage(getRandomMessage('start_round', { round: gameState.currentRound }));
                 }

                setupPuzzleBoard(puzzleBoard, puzzleData);
                createAlphabetPanel();
                gameState.guessedLetters.forEach(letter => {
                     document.querySelectorAll(`.puzzle-tile[data-letter="${letter}"]`).forEach(tile => tile.classList.add('revealed'));
                });
                updateUI();
            }

             async function handleEndOfHour() {
                updateHostMessage("Fantasztikus j√°t√©k volt, mind a 10 feladv√°nyt megfejtetted!", true);

                const canPlay = gameState.hourlyWinnings >= MAIN_PRIZE_THRESHOLD;
                let neededToTopUp = 0;
                let canTopUp = false;
                
                if (!canPlay) {
                    neededToTopUp = MAIN_PRIZE_THRESHOLD - gameState.hourlyWinnings;
                    canTopUp = gameState.playerScore >= neededToTopUp;
                }
                
                try {
                    if (canPlay) {
                        const play = await showModal({
                            title: 'F≈ëd√≠j J√°t√©k Lehet≈ës√©g',
                            text: `Gratul√°lok, j√°tszhatsz a F≈ëd√≠j√©rt! Kock√°ztatod a menetben gy≈±jt√∂tt <strong>${gameState.hourlyWinnings.toLocaleString('hu-HU')} Ft</strong>-ot a dupl√°j√°√©rt?`,
                            confirmText: 'Kock√°ztatok!', cancelText: 'Ink√°bb nem'
                        });
                        if (play) {
                             startMainPrizeGame(false);
                        } else { 
                            gameState.playerScore += gameState.hourlyWinnings;
                            gameState.hourlyWinnings = 0;
                            saveWeeklyScore(gameState.playerScore);
                            gameOver(`Okos d√∂nt√©s! A nyerem√©nyed m√°r a zsebedben van.`); 
                        }
                    } else if (canTopUp) {
                        const topUp = await showModal({
                            title: 'F≈ëd√≠j J√°t√©k - Kip√≥tl√°s',
                            text: `Sajnos nem gy≈±lt √∂ssze a sz√ºks√©ges <strong>${MAIN_PRIZE_THRESHOLD.toLocaleString('hu-HU')} Ft</strong>. <br><br>Szeretn√©d a hi√°nyz√≥ <strong>${neededToTopUp.toLocaleString('hu-HU')} Ft</strong>-ot kip√≥tolni a teljes vagyonodb√≥l, hogy j√°tszhass a F≈ëd√≠j√©rt?`,
                            confirmText: 'Igen, p√≥tolom!', cancelText: 'Nem, k√∂sz√∂n√∂m'
                        });
                        if (topUp) {
                            gameState.playerScore -= neededToTopUp;
                            gameState.hourlyWinnings = MAIN_PRIZE_THRESHOLD;
                            saveWeeklyScore(gameState.playerScore);
                            updateUI();
                            startMainPrizeGame(false);
                        } else { 
                            gameState.playerScore += gameState.hourlyWinnings;
                            gameState.hourlyWinnings = 0;
                            saveWeeklyScore(gameState.playerScore);
                            gameOver(`Rendben van! A nyerem√©nyed m√°r biztos helyen van.`); 
                        }
                    } else {
                        await showModal({
                            title: 'J√°t√©k V√©ge',
                            text: `Sajnos nem gy≈±lt √∂ssze a F≈ëd√≠j J√°t√©khoz sz√ºks√©ges √∂sszeg, √©s a teljes vagyonodb√≥l sem tudod kip√≥tolni. Gratul√°lok az eddigi nyerem√©nyedhez!`,
                            showCancel: false
                        });
                        gameState.playerScore += gameState.hourlyWinnings;
                        gameState.hourlyWinnings = 0;
                        saveWeeklyScore(gameState.playerScore);
                        gameOver();
                    }
                } catch { 
                    gameState.playerScore += gameState.hourlyWinnings;
                    gameState.hourlyWinnings = 0;
                    saveWeeklyScore(gameState.playerScore);
                    gameOver(`D√∂nt√©s n√©lk√ºl a nyerem√©nyed m√°r a zsebedben van. Gratul√°lok!`);
                }
            }
            
            function getEndOfSundayTimestamp() {
                const now = new Date();
                const dayOfWeek = now.getDay();
                const daysUntilSunday = (7 - dayOfWeek) % 7;
                const endOfSunday = new Date(now);
                endOfSunday.setDate(now.getDate() + daysUntilSunday);
                endOfSunday.setHours(23, 59, 59, 999);
                return endOfSunday.getTime();
            }

            function getActiveBonuses() {
                let bonuses = JSON.parse(localStorage.getItem('pordgesdFelActiveBonuses') || '[]');
                const activeBonuses = bonuses.filter(bonus => bonus.expiry > Date.now());
                if (bonuses.length !== activeBonuses.length) {
                    localStorage.setItem('pordgesdFelActiveBonuses', JSON.stringify(activeBonuses));
                }
                return activeBonuses;
            }

            function getPrizeInventory() {
                const currentWeekId = getWeekNumber(new Date());
                let inventory = JSON.parse(localStorage.getItem('pordgesdFelPrizeInventory') || '[]');
                const validInventory = inventory.filter(prize => prize.weekId === currentWeekId);
                if(inventory.length !== validInventory.length) savePrizeInventory(validInventory);
                return validInventory;
            }

            function savePrizeInventory(inventory) {
                localStorage.setItem('pordgesdFelPrizeInventory', JSON.stringify(inventory));
            }
            
            function isPrizeActive(prizeId) {
                return getActiveBonuses().some(bonus => bonus.id === prizeId);
            }

            function activatePrize(prizeIndex) {
                let inventory = getPrizeInventory();
                const prize = inventory.splice(prizeIndex, 1)[0];
                if(!prize) return;

                let activeBonuses = getActiveBonuses();
                let expiry = (prize.duration === '24h') ? Date.now() + 24 * 60 * 60 * 1000 : getEndOfSundayTimestamp();
                activeBonuses.push({ ...prize, expiry: expiry });
                
                if(prize.id === 'lotto_bajnok'){
                    gameState.playerScore += 100000;
                    saveWeeklyScore(gameState.playerScore);
                }

                localStorage.setItem('pordgesdFelActiveBonuses', JSON.stringify(activeBonuses));
                savePrizeInventory(inventory);
                alert(`"${prize.name}" b√≥nusz aktiv√°lva!`);
                updateUI();
                showPrizeChest();
            }

            function showActiveBonuses() {
                activeBonusesModal.classList.add('visible');
                const bonuses = getActiveBonuses();
                activeBonusesList.innerHTML = bonuses.length === 0 ? '<li>Jelenleg nincsenek akt√≠v b√≥nuszaid.</li>' : bonuses.map(bonus => {
                    const expiryDate = new Date(bonus.expiry);
                    return `<li><span class="bonus-name">${bonus.name}</span><span class="bonus-expiry">Lej√°r: ${expiryDate.toLocaleString('hu-HU')}</span></li>`;
                }).join('');
            }
            
            function showPrizeChest() {
                prizeChestModal.classList.add('visible');
                const inventory = getPrizeInventory();
                prizeChestList.innerHTML = inventory.length === 0 ? '<li>Jelenleg nincsenek aktiv√°lhat√≥ nyerem√©nyeid a l√°d√°ban.</li>' : inventory.map((prize, index) => `
                    <li>
                        <div class="prize-info">
                            <span class="bonus-name">${prize.name}</span>
                            <span class="prize-expiry">${prize.description}</span>
                        </div>
                        <button class="modal-btn activate-prize-btn" data-prize-index="${index}">Aktiv√°l√°s</button>
                    </li>
                `).join('');
                
                document.querySelectorAll('.activate-prize-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => activatePrize(parseInt(e.target.dataset.prizeIndex, 10)));
                });
            }

            function getDailyLottoNumbers(date = new Date()) {
                const dateStr = getFormattedDate(date);
                const seed = parseInt(dateStr.replace(/-/g, ''));
                const random = seededRandom(seed);
                const generatedNumbers = [];
                const available = Array.from({length: LOTTO_NUM_RANGE}, (_, i) => i + 1);
                for(let i = 0; i < 5; i++){
                    const randIndex = Math.floor(random() * available.length);
                    generatedNumbers.push(available.splice(randIndex, 1)[0]);
                }
                return generatedNumbers.sort((a,b) => a-b);
            }

            function launchLotto(isDevTest = false) {
                isDevModeActive = isDevTest;
                lottoInfoArea.style.display = 'block';
                lottoBettingArea.style.display = 'none';
                lottoModal.classList.add('visible');
                lottoModal.querySelector('.dev-mode-indicator').style.display = isDevModeActive ? 'block' : 'none';

                const now = new Date();
                const hour = now.getHours();
                const todayStr = getFormattedDate(now);
                const todaysTickets = isDevTest ? [] : JSON.parse(localStorage.getItem(`lottoTickets_${todayStr}`) || '[]');
                
                let winningNumbers = null;
                let drawingDate = null;

                if (hour >= 19) {
                    winningNumbers = getDailyLottoNumbers();
                    drawingDate = now;
                } else { 
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    winningNumbers = getDailyLottoNumbers(yesterday);
                    drawingDate = yesterday;
                }

                lottoDrawingContainer.style.display = winningNumbers ? 'block' : 'none';
                if(winningNumbers) displayWinningNumbers(drawingDate, winningNumbers);
                
                lottoSubmittedTickets.innerHTML = '';
                if(todaysTickets.length > 0) displaySubmittedTickets(todaysTickets, (hour >= 19) ? winningNumbers : null);

                const canBuy = hour < 19;
                lottoBuyTicketBtn.style.display = canBuy || isDevTest ? 'inline-flex' : 'none';
                if (canBuy || isDevTest) {
                    const ticketsLeft = MAX_LOTTO_TICKETS_PER_DAY - todaysTickets.length;
                    lottoStatusText.textContent = isDevModeActive ? "TESZT M√ìD: Korl√°tlan szelv√©ny." : (ticketsLeft > 0 ? `Ma m√©g ${ticketsLeft} szelv√©nyt adhatsz fel. A sorsol√°s este 7-kor!` : "M√°ra el√©rted a maxim√°lis szelv√©nyek sz√°m√°t.");
                    if (!isDevModeActive && ticketsLeft <= 0) lottoBuyTicketBtn.style.display = 'none';
                } else {
                    lottoStatusText.textContent = "A mai fogad√°s lez√°rult. Holnap √∫jra pr√≥b√°lkozhatsz!";
                }
                
                if(hour >= 19 && !isDevModeActive) checkForLottoWinnings();
            }

            function showLottoBettingView() {
                if (!isDevModeActive && (!gameState || !gameState.hasFreeLottoTicket)) {
                    const todayStr = getFormattedDate(new Date());
                    const todaysTickets = JSON.parse(localStorage.getItem(`lottoTickets_${todayStr}`) || '[]');
                    if (todaysTickets.length >= MAX_LOTTO_TICKETS_PER_DAY) {
                        alert("M√°ra el√©rted a maxim√°lis szelv√©nyek sz√°m√°t.");
                        return;
                    }
                    if (!gameState || gameState.playerScore < LOTTO_COST) {
                        alert(`Nincs el√©g zsetonod egy szelv√©ny v√°s√°rl√°s√°hoz! (${LOTTO_COST.toLocaleString('hu-HU')} Ft)`);
                        return;
                    }
                }
                lottoCostText.innerHTML = (isDevModeActive || (gameState && gameState.hasFreeLottoTicket)) ? "A szelv√©ny <strong>INGYENES</strong>" : `A szelv√©ny √°ra: <strong>${LOTTO_COST.toLocaleString('hu-HU')} Ft</strong>`;
                lottoInfoArea.style.display = 'none';
                lottoBettingArea.style.display = 'block';
                resetLottoSelection();
                buildLottoGrid();
            }
            
            function displayWinningNumbers(dateObj, numbers) {
                 const weekdays = ["vas√°rnap", "h√©tf≈ë", "kedd", "szerda", "cs√ºt√∂rt√∂k", "p√©ntek", "szombat"];
                 lottoDrawingDate.textContent = `A ${getFormattedDate(dateObj)} (${weekdays[dateObj.getDay()]}) napi nyer≈ësz√°mok:`;
                 lottoWinningNumbers.innerHTML = numbers.map(n => `<div class="lotto-ball">${n}</div>`).join('');
            }
            
            function displaySubmittedTickets(tickets, winningNumbers) {
                const header = document.createElement('h4');
                header.textContent = 'Mai szelv√©nyeid:';
                lottoSubmittedTickets.appendChild(header);

                tickets.forEach((ticket, index) => {
                    const ticketDiv = document.createElement('div');
                    ticketDiv.className = 'submitted-ticket-container';
                    const ticketNumbersHTML = ticket.numbers.map(num => `<div class="submitted-ticket-number ${winningNumbers && winningNumbers.includes(num) ? 'match' : ''}">${num}</div>`).join('');
                    ticketDiv.innerHTML = `<div class="submitted-ticket-header">${index + 1}. szelv√©ny (${ticket.timestamp})</div><div class="submitted-ticket-numbers">${ticketNumbersHTML}</div>`;
                    lottoSubmittedTickets.appendChild(ticketDiv);
                });
            }

            function buildLottoGrid() {
                lottoGrid.innerHTML = '';
                for (let i = 1; i <= LOTTO_NUM_RANGE; i++) {
                    const numEl = document.createElement('div');
                    numEl.className = 'lotto-number';
                    numEl.textContent = i;
                    numEl.dataset.number = i;
                    numEl.addEventListener('click', () => handleLottoNumberSelect(i));
                    lottoGrid.appendChild(numEl);
                }
            }
            
            function handleLottoNumberSelect(num) {
                const numEl = lottoGrid.querySelector(`[data-number='${num}']`);
                const index = lottoState.selectedNumbers.indexOf(num);
                if (index > -1) {
                    lottoState.selectedNumbers.splice(index, 1);
                    numEl.classList.remove('selected');
                } else if (lottoState.selectedNumbers.length < 5) {
                    lottoState.selectedNumbers.push(num);
                    numEl.classList.add('selected');
                }
                lottoSelectedDisplay.textContent = lottoState.selectedNumbers.length > 0 ? `Nyer≈ësz√°maid: ${lottoState.selectedNumbers.sort((a,b)=>a-b).join(', ')}` : 'Nyer≈ësz√°maid: -';
                lottoSubmitBtn.disabled = lottoState.selectedNumbers.length !== 5;
            }

            function resetLottoSelection() {
                lottoState.selectedNumbers = [];
                lottoSelectedDisplay.textContent = `Nyer≈ësz√°maid: -`;
                if(lottoGrid.innerHTML !== '') document.querySelectorAll('.lotto-number.selected').forEach(el => el.classList.remove('selected'));
                lottoSubmitBtn.disabled = true;
            }
            
            function submitLottoTicket() {
                if (lottoState.selectedNumbers.length !== 5) return alert("K√©rlek, v√°lassz ki 5 sz√°mot!");
                
                if (isDevModeActive) {
                    alert("TESZT M√ìD: Szelv√©ny feladva t√©t n√©lk√ºl!");
                } else if (gameState.hasFreeLottoTicket) {
                    gameState.hasFreeLottoTicket = false;
                    alert("Ingyenes szelv√©ny feladva! Sok szerencs√©t!");
                } else {
                    gameState.playerScore -= LOTTO_COST;
                    saveWeeklyScore(gameState.playerScore);
                    alert("Szelv√©ny feladva! Sok szerencs√©t!");
                }
                updateUI();
                
                if (!isDevModeActive) {
                    const todayStr = getFormattedDate(new Date());
                    const todaysTickets = JSON.parse(localStorage.getItem(`lottoTickets_${todayStr}`) || '[]');
                    todaysTickets.push({ numbers: lottoState.selectedNumbers.sort((a,b) => a-b), timestamp: new Date().toLocaleTimeString('hu-HU') });
                    localStorage.setItem(`lottoTickets_${todayStr}`, JSON.stringify(todaysTickets));
                }
                
                lottoInfoArea.style.display = 'block';
                lottoBettingArea.style.display = 'none';
                launchLotto(isDevModeActive);
            }
            
            function checkForLottoWinnings() {
                const todayStr = getFormattedDate(new Date());
                const checkedKey = `lottoWinningsChecked_${todayStr}`;
                if (localStorage.getItem(checkedKey)) return;

                const todaysTickets = JSON.parse(localStorage.getItem(`lottoTickets_${todayStr}`) || '[]');
                if (todaysTickets.length === 0) {
                     localStorage.setItem(checkedKey, 'true');
                     return;
                }

                const winningNumbers = getDailyLottoNumbers();
                const currentWeekId = getWeekNumber(new Date());
                const prizesWon = todaysTickets.map(ticket => {
                    const matches = ticket.numbers.filter(num => winningNumbers.includes(num)).length;
                    return LOTTO_PRIZES[matches] ? {...LOTTO_PRIZES[matches], weekId: currentWeekId} : null;
                }).filter(Boolean);

                if (prizesWon.length > 0) {
                    let inventory = getPrizeInventory();
                    inventory.push(...prizesWon);
                    savePrizeInventory(inventory);
                    alert(`Gratul√°lok, nyert√©l a mai lott√≥n! A jutalmad a Nyerem√©nyl√°d√°ba ker√ºlt, ahol aktiv√°lhatod.`);
                    updatePrizeChestHud();
                }
                localStorage.setItem(checkedKey, 'true');
            }
            
            function initializeGame() {
                if(gameState && gameState.gameInProgress) return;
                resetGameState(true);
                document.body.classList.toggle('sunday-special', isSunday);
                mainHudLabel.textContent = isSunday ? "Heti Kassza" : "√ñsszes Zseton";

                const hourId = Math.floor(Date.now() / (1000 * 60 * 60));
                hourlyPuzzleIndices = getHourlyPuzzles(seededRandom(hourId));
                gameState.transferUsedThisHour = localStorage.getItem(`pordgesdFelTransfer_${hourId}`) === 'true';
                
                const currentWeekId = getWeekNumber(new Date());
                const millionaireWeek = localStorage.getItem('millionaireUntilWeekId');
                 if (millionaireWeek && millionaireWeek === currentWeekId) {
                    gameState.isMillionaire = true;
                    document.body.classList.add('millionaire-active');
                } else {
                    localStorage.removeItem('millionaireUntilWeekId');
                }

                gameState.puzzleHourId = hourId;
                gameState.gameInProgress = true;
                
                 if(isSunday && gameState.playerScore <= 0){
                    puzzleBoard.innerHTML = '<div style="text-align:center; font-size: 1.2rem; color: white; padding: 2rem; line-height: 1.5;">Nincs p√©nz a Heti Kassz√°ban a vas√°rnapi j√°t√©khoz.<br>Gyere vissza h√©tk√∂znap gy≈±jteni!</div>';
                    alphabetPanel.innerHTML = '';
                    gameState.gameInProgress = false;
                    newGameButton.style.display = 'block';
                    wheelCenterButton.style.display = 'none';
                    [solveButton, solveButtonDesktop, nyero21Button, nyero21ButtonDesktop, transferButton, transferButtonDesktop, lottoButton, lottoButtonDesktop].forEach(btn => btn.style.display = 'none');
                    updateUI();
                    return;
                 }
                
                newGameButton.style.display = 'none';
                skipErrorBtn.style.display = 'none';
                wheelCenterButton.style.display = 'flex';
                solveButton.style.display = 'inline-flex';
                nyero21Button.style.display = 'inline-flex';
                transferButton.style.display = 'inline-flex';
                lottoButton.style.display = 'inline-flex';
                setupRound();
            }

            window.addEventListener('beforeunload', () => {
                if (gameState && gameState.gameInProgress) {
                    if (localStorage.getItem('quitHourId') != gameState.puzzleHourId) { 
                        localStorage.setItem('quitHourId', gameState.puzzleHourId.toString());
                    }
                    localStorage.setItem('lastPlayedHourId', gameState.puzzleHourId.toString());
                }
            });
            
            logoContainer.addEventListener('click', () => {
                const code = prompt("Fejleszt≈ëi k√≥d:");
                if (code === '0000') {
                    if (!gameState) { 
                        resetGameState(true); 
                        updateUI();
                    }
                    openDevMenu();
                } else if (code) {
                    alert("Hib√°s k√≥d!");
                }
            });
            
            devModalCloseBtn.addEventListener('click', () => devModal.classList.remove('visible'));

            devForceMainPrizeBtn.addEventListener('click', () => {
                if (!gameState) resetGameState(true);
                devModal.classList.remove('visible');
                startMainPrizeGame(true);
            });
            devTestLottoBtn.addEventListener('click', () => {
                if (!gameState) resetGameState(true);
                devModal.classList.remove('visible');
                launchLotto(true);
            });
            devTestNyero21Btn.addEventListener('click', () => {
                if (!gameState) resetGameState(true);
                devModal.classList.remove('visible');
                launchNyero21(true);
            });
            
            wheelCenterButton.addEventListener('click', togglePowerMeter);
            newGameButton.addEventListener('click', () => { newGameButton.disabled = true; location.reload(); });
            skipErrorBtn.addEventListener('click', () => {
                gameState.isSpinning = false;
                endTurn();
                skipErrorBtn.style.display = 'none';
            });


            [solveButton, solveButtonDesktop].forEach(btn => btn.addEventListener('click', () => solvePuzzle(false)));
            [transferButton, transferButtonDesktop].forEach(btn => btn.addEventListener('click', handleTransfer));
            [lottoButton, lottoButtonDesktop].forEach(btn => btn.addEventListener('click', () => launchLotto(false)));
            [nyero21Button, nyero21ButtonDesktop].forEach(btn => btn.addEventListener('click', () => launchNyero21(false)));
            
            lottoBuyTicketBtn.addEventListener('click', showLottoBettingView);
            lottoCancelBtn.addEventListener('click', () => {
                lottoModal.classList.remove('visible');
                isDevModeActive = false;
            });
            lottoCancelBetBtn.addEventListener('click', () => {
                lottoBettingArea.style.display = 'none';
                lottoInfoArea.style.display = 'block';
            });
            lottoSubmitBtn.addEventListener('click', submitLottoTicket);
            lottoPrizeHud.addEventListener('click', showActiveBonuses);
            activeBonusesCloseBtn.addEventListener('click', () => activeBonusesModal.classList.remove('visible'));
            prizeChestHud.addEventListener('click', showPrizeChest);
            prizeChestCloseBtn.addEventListener('click', () => prizeChestModal.classList.remove('visible'));
            
            mainPrizeSelectConfirmBtn.addEventListener('click', runMainPrizeCountdown);
            mainPrizeConfirmBtn.addEventListener('click', () => {
                 const mainPrizePuzzles = allPuzzles.filter(p => p.category === 'F≈ëd√≠j Feladv√°ny');
                 const mainPrizePuzzle = mainPrizePuzzles[gameState.puzzleHourId % mainPrizePuzzles.length];
                 const normalizeText = (text) => text.toUpperCase().replace(/[^A-Z√Å√â√ç√ì√ñ≈êU√ö√ú≈∞0-9]/g, '');
                 const cleanPuzzle = normalizeText(mainPrizePuzzle.puzzle);
                 const attempt = normalizeText(mainPrizeSolveInput.value);
                 endMainPrizeGame(attempt === cleanPuzzle);
            });
            mainPrizeCloseBtn.addEventListener('click', forceEndMainPrize);


            nyero21StartGameBtn.addEventListener('click', startNyero21);
            nyero21CancelBtn.addEventListener('click', () => {
                nyero21Modal.classList.remove('visible');
                isDevModeActive = false;
            });
            nyero21HitBtn.addEventListener('click', () => {
                const unflippedCard = nyero21CardDeck.querySelector('.nyero21-card:not(.flipped)');
                if (unflippedCard) unflippedCard.dispatchEvent(new Event('click'));
            });
            nyero21StandBtn.addEventListener('click', standNyero21);
            nyero21NewGameBtn.addEventListener('click', () => {
                nyero21GameArea.style.display = 'none';
                nyero21StakingArea.style.display = 'block';
                 nyero21PlaysLeft.textContent = isDevModeActive ? "TESZT M√ìD: Korl√°tlan j√°t√©k." : `Ebben az √≥r√°ban m√©g ${MINIGAME_PLAYS_PER_HOUR - (gameState ? gameState.nyero21PlaysThisHour : 0)} alkalommal j√°tszhatsz.`;
            });
            nyero21CloseBtn.addEventListener('click', () => {
                nyero21Modal.classList.remove('visible');
                isDevModeActive = false;
            });
            
            initializeGame();
        });
    </script>
</body>
</html>
